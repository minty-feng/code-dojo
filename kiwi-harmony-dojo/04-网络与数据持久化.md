# ç½‘ç»œä¸æ•°æ®æŒä¹…åŒ–

## ğŸ’¡ æ ¸å¿ƒç»“è®º

1. **@ohos.net.httpæä¾›HTTPç½‘ç»œè¯·æ±‚èƒ½åŠ›**
2. **Preferencesé€‚åˆé”®å€¼å¯¹å­˜å‚¨**
3. **å…³ç³»å‹æ•°æ®åº“é€‚åˆå¤æ‚æ•°æ®å­˜å‚¨**
4. **æ–‡ä»¶ç®¡ç†ä½¿ç”¨@ohos.file.fs**
5. **ç½‘ç»œè¯·æ±‚éœ€è¦é…ç½®æƒé™**

---

## 1. ç½‘ç»œè¯·æ±‚

### 1.1 HTTPè¯·æ±‚

```typescript
import http from '@ohos.net.http'

class HttpUtil {
  static async get(url: string): Promise<any> {
    const httpRequest = http.createHttp()
    
    try {
      const response = await httpRequest.request(url, {
        method: http.RequestMethod.GET,
        header: {
          'Content-Type': 'application/json'
        },
        readTimeout: 10000,
        connectTimeout: 10000
      })
      
      if (response.responseCode === 200) {
        return JSON.parse(response.result as string)
      } else {
        throw new Error(`HTTP Error: ${response.responseCode}`)
      }
    } finally {
      httpRequest.destroy()
    }
  }
  
  static async post(url: string, data: object): Promise<any> {
    const httpRequest = http.createHttp()
    
    try {
      const response = await httpRequest.request(url, {
        method: http.RequestMethod.POST,
        header: {
          'Content-Type': 'application/json'
        },
        extraData: JSON.stringify(data)
      })
      
      return JSON.parse(response.result as string)
    } finally {
      httpRequest.destroy()
    }
  }
}

// ä½¿ç”¨
@Entry
@Component
struct NetworkDemo {
  @State data: string = ''

  async loadData() {
    try {
      const result = await HttpUtil.get('https://api.example.com/data')
      this.data = JSON.stringify(result)
    } catch (error) {
      console.error('è¯·æ±‚å¤±è´¥:', error)
    }
  }

  build() {
    Column() {
      Button('åŠ è½½æ•°æ®')
        .onClick(() => {
          this.loadData()
        })
      
      Text(this.data)
        .margin({ top: 20 })
    }
  }
}
```

---

## 2. æ•°æ®æŒä¹…åŒ–

### 2.1 Preferencesï¼ˆé¦–é€‰é¡¹ï¼‰

```typescript
import preferences from '@ohos.data.preferences'

class StorageUtil {
  private static pref: preferences.Preferences
  
  static async init(context) {
    this.pref = await preferences.getPreferences(context, 'mystore')
  }
  
  static async put(key: string, value: string | number | boolean) {
    await this.pref.put(key, value)
    await this.pref.flush()  // æŒä¹…åŒ–
  }
  
  static async get(key: string, defaultValue: any): Promise<any> {
    return await this.pref.get(key, defaultValue)
  }
  
  static async remove(key: string) {
    await this.pref.delete(key)
    await this.pref.flush()
  }
  
  static async clear() {
    await this.pref.clear()
    await this.pref.flush()
  }
}

// ä½¿ç”¨
@Entry
@Component
struct StorageDemo {
  @State username: string = ''

  async aboutToAppear() {
    await StorageUtil.init(this.getContext())
    this.username = await StorageUtil.get('username', '') as string
  }

  async saveUsername() {
    await StorageUtil.put('username', this.username)
  }

  build() {
    Column() {
      TextInput({ text: this.username })
        .onChange((value) => {
          this.username = value
        })
      
      Button('ä¿å­˜')
        .onClick(() => {
          this.saveUsername()
        })
    }
  }
}
```

### 2.2 å…³ç³»å‹æ•°æ®åº“

```typescript
import relationalStore from '@ohos.data.relationalStore'

class DatabaseUtil {
  private static store: relationalStore.RdbStore
  
  static async init(context) {
    const config: relationalStore.StoreConfig = {
      name: 'mydb.db',
      securityLevel: relationalStore.SecurityLevel.S1
    }
    
    this.store = await relationalStore.getRdbStore(context, config)
    
    // åˆ›å»ºè¡¨
    const sql = `
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        age INTEGER,
        email TEXT
      )
    `
    await this.store.executeSql(sql)
  }
  
  static async insert(name: string, age: number, email: string) {
    const valueBucket = {
      'name': name,
      'age': age,
      'email': email
    }
    
    const rowId = await this.store.insert('users', valueBucket)
    return rowId
  }
  
  static async query(): Promise<any[]> {
    const predicates = new relationalStore.RdbPredicates('users')
    const resultSet = await this.store.query(predicates)
    
    const users = []
    while (resultSet.goToNextRow()) {
      users.push({
        id: resultSet.getLong(resultSet.getColumnIndex('id')),
        name: resultSet.getString(resultSet.getColumnIndex('name')),
        age: resultSet.getLong(resultSet.getColumnIndex('age')),
        email: resultSet.getString(resultSet.getColumnIndex('email'))
      })
    }
    
    resultSet.close()
    return users
  }
  
  static async update(id: number, name: string) {
    const valueBucket = { 'name': name }
    const predicates = new relationalStore.RdbPredicates('users')
    predicates.equalTo('id', id)
    
    const rows = await this.store.update(valueBucket, predicates)
    return rows
  }
  
  static async delete(id: number) {
    const predicates = new relationalStore.RdbPredicates('users')
    predicates.equalTo('id', id)
    
    const rows = await this.store.delete(predicates)
    return rows
  }
}
```

---

## 3. æ–‡ä»¶æ“ä½œ

```typescript
import fs from '@ohos.file.fs'

class FileUtil {
  static async writeFile(path: string, content: string) {
    try {
      const file = fs.openSync(path, fs.OpenMode.CREATE | fs.OpenMode.WRITE_ONLY)
      fs.writeSync(file.fd, content)
      fs.closeSync(file)
      console.log('æ–‡ä»¶å†™å…¥æˆåŠŸ')
    } catch (error) {
      console.error('æ–‡ä»¶å†™å…¥å¤±è´¥:', error)
    }
  }
  
  static async readFile(path: string): Promise<string> {
    try {
      const file = fs.openSync(path, fs.OpenMode.READ_ONLY)
      const buffer = new ArrayBuffer(4096)
      const readLen = fs.readSync(file.fd, buffer)
      fs.closeSync(file)
      
      const decoder = new util.TextDecoder('utf-8')
      return decoder.decode(new Uint8Array(buffer.slice(0, readLen)))
    } catch (error) {
      console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error)
      return ''
    }
  }
}
```

---

## å‚è€ƒèµ„æº

- åˆ†å¸ƒå¼æ•°æ®ç®¡ç†å¼€å‘æŒ‡å—
- æ•°æ®æŒä¹…åŒ–å¼€å‘
- æ–‡ä»¶ç®¡ç†å¼€å‘

