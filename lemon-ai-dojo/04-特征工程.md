# 特征工程

## 💡 核心结论

1. **数据决定模型的上限，算法只是逼近这个上限**
2. **特征工程包括：特征清洗、特征构造、特征选择、特征变换**
3. **归一化和标准化对距离相关算法至关重要**
4. **类别特征需要编码（One-Hot、Label Encoding）**
5. **特征组合可以捕获非线性关系**

---

## 1. 数据清洗

```python
import pandas as pd
import numpy as np

# 加载数据
df = pd.read_csv('data.csv')

# 1. 缺失值处理
print(df.isnull().sum())

# 删除缺失值
df_clean = df.dropna()

# 填充缺失值
df['age'].fillna(df['age'].mean(), inplace=True)  # 均值填充
df['city'].fillna(df['city'].mode()[0], inplace=True)  # 众数填充
df['salary'].fillna(method='ffill', inplace=True)  # 前向填充

# 2. 异常值处理
# IQR方法
Q1 = df['price'].quantile(0.25)
Q3 = df['price'].quantile(0.75)
IQR = Q3 - Q1
lower = Q1 - 1.5 * IQR
upper = Q3 + 1.5 * IQR
df = df[(df['price'] >= lower) & (df['price'] <= upper)]

# 3. 重复值处理
df = df.drop_duplicates()
```

---

## 2. 特征变换

### 2.1 归一化

```python
from sklearn.preprocessing import MinMaxScaler

# Min-Max归一化：[0, 1]
scaler = MinMaxScaler()
X_normalized = scaler.fit_transform(X)

# 手动实现
X_normalized = (X - X.min()) / (X.max() - X.min())
```

### 2.2 标准化

```python
from sklearn.preprocessing import StandardScaler

# Z-score标准化：均值0，方差1
scaler = StandardScaler()
X_standardized = scaler.fit_transform(X)

# 手动实现
X_standardized = (X - X.mean()) / X.std()
```

### 2.3 对数变换

```python
# 处理偏态分布
df['log_price'] = np.log1p(df['price'])  # log(1 + x)
```

---

## 3. 类别特征编码

### 3.1 One-Hot编码

```python
from sklearn.preprocessing import OneHotEncoder
import pandas as pd

# 方法1：pandas
df_encoded = pd.get_dummies(df, columns=['city', 'gender'])

# 方法2：sklearn
encoder = OneHotEncoder(sparse=False)
city_encoded = encoder.fit_transform(df[['city']])
```

### 3.2 Label Encoding

```python
from sklearn.preprocessing import LabelEncoder

encoder = LabelEncoder()
df['city_encoded'] = encoder.fit_transform(df['city'])
```

---

## 4. 特征选择

```python
from sklearn.feature_selection import SelectKBest, f_classif

# 选择K个最佳特征
selector = SelectKBest(score_func=f_classif, k=10)
X_selected = selector.fit_transform(X, y)

# 查看选择的特征
mask = selector.get_support()
selected_features = X.columns[mask]
print(f"选择的特征: {selected_features}")
```

---

## 参考资源

- 《Feature Engineering for Machine Learning》
- Kaggle Feature Engineering

