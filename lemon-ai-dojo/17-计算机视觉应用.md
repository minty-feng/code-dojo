# 计算机视觉应用

## 💡 核心结论

1. **图像分类是计算机视觉的基础任务**
2. **目标检测定位物体位置，YOLO系列速度快**
3. **语义分割逐像素分类，U-Net是经典架构**
4. **迁移学习可以用预训练模型快速解决新任务**
5. **数据增强是提升模型性能的关键**

---

## 1. 图像分类

### 1.1 使用预训练模型

```python
import torch
import torchvision.models as models
from torchvision import transforms
from PIL import Image

# 加载预训练模型
model = models.resnet50(pretrained=True)
model.eval()

# 图像预处理
transform = transforms.Compose([
    transforms.Resize(256),
    transforms.CenterCrop(224),
    transforms.ToTensor(),
    transforms.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    )
])

# 预测
image = Image.open('image.jpg')
input_tensor = transform(image).unsqueeze(0)

with torch.no_grad():
    output = model(input_tensor)
    probabilities = torch.softmax(output[0], dim=0)
    top5_prob, top5_catid = torch.topk(probabilities, 5)

# 加载ImageNet标签
with open('imagenet_classes.txt') as f:
    categories = [s.strip() for s in f.readlines()]

for i in range(5):
    print(f"{categories[top5_catid[i]]}: {top5_prob[i].item():.2%}")
```

### 1.2 迁移学习

```python
# 冻结预训练层，只训练最后的分类层
model = models.resnet50(pretrained=True)

# 冻结所有层
for param in model.parameters():
    param.requires_grad = False

# 替换最后的全连接层
num_classes = 10
model.fc = torch.nn.Linear(model.fc.in_features, num_classes)

# 只训练新的分类层
optimizer = torch.optim.Adam(model.fc.parameters(), lr=0.001)
```

---

## 2. 目标检测

### 2.1 YOLO

```python
import cv2
from ultralytics import YOLO

# 加载模型
model = YOLO('yolov8n.pt')

# 预测
image = cv2.imread('image.jpg')
results = model(image)

# 解析结果
for result in results:
    boxes = result.boxes
    for box in boxes:
        x1, y1, x2, y2 = box.xyxy[0]
        confidence = box.conf[0]
        class_id = box.cls[0]
        
        # 绘制边界框
        cv2.rectangle(image, (int(x1), int(y1)), (int(x2), int(y2)), (0, 255, 0), 2)
        cv2.putText(image, f'{model.names[int(class_id)]} {confidence:.2f}',
                   (int(x1), int(y1)-10), cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)

cv2.imshow('Detection', image)
cv2.waitKey(0)
```

---

## 3. 语义分割

```python
from torchvision.models.segmentation import deeplabv3_resnet50

# 加载模型
model = deeplabv3_resnet50(pretrained=True)
model.eval()

# 预测
input_tensor = transform(image).unsqueeze(0)

with torch.no_grad():
    output = model(input_tensor)['out'][0]
    output_predictions = output.argmax(0)

# 可视化
import matplotlib.pyplot as plt

plt.imshow(output_predictions)
plt.show()
```

---

## 4. 数据增强

```python
from torchvision import transforms

# 训练时增强
train_transform = transforms.Compose([
    transforms.RandomResizedCrop(224),
    transforms.RandomHorizontalFlip(),
    transforms.RandomRotation(15),
    transforms.ColorJitter(brightness=0.2, contrast=0.2),
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])
])

# 测试时不增强
test_transform = transforms.Compose([
    transforms.Resize(256),
    transforms.CenterCrop(224),
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])
])
```

---

## 参考资源

- PyTorch Vision库
- YOLO官方文档
- Papers With Code

