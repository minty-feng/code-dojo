

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>03-Vue è·¯ç”±ä¸çŠ¶æ€ç®¡ç† &mdash; Frontend Tutorial 1.0.0 æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=f07cb45e" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=34088549"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="next" title="Angular æ•™ç¨‹" href="../angular/index.html" />
    <link rel="prev" title="02-Vue ç»„ä»¶ç³»ç»Ÿä¸é€šä¿¡" href="02-component-system.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            Frontend Tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ç›®å½•</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Frontend Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00-environment-setup.html">00-ç¯å¢ƒé…ç½®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-debugging-techniques.html">01-è°ƒè¯•æŠ€å·§</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-testing-techniques.html">02-æµ‹è¯•æŠ€æœ¯</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-performance-optimization.html">03-æ€§èƒ½ä¼˜åŒ–</a></li>
<li class="toctree-l1"><a class="reference internal" href="../html/index.html">HTML æ•™ç¨‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../css/index.html">CSS æ•™ç¨‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/index.html">JavaScript æ•™ç¨‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../react/index.html">React æ•™ç¨‹</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Vue æ•™ç¨‹</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Vue æ ¸å¿ƒæŠ€æœ¯</a></li>
<li class="toctree-l2"><a class="reference internal" href="01-composition-api-core.html">01-Compositionæ ¸å¿ƒ</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-component-system.html">02-ç»„ä»¶ç³»ç»Ÿä¸é€šä¿¡</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">03-è·¯ç”±ä¸çŠ¶æ€ç®¡ç†</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">ğŸ“‹ å­¦ä¹ ç›®æ ‡</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vue-router">ğŸ›£ï¸ Vue Router åŸºç¡€</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">å®‰è£…å’Œé…ç½®</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">è·¯ç”±è§†å›¾å’Œé“¾æ¥</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">ç¼–ç¨‹å¼å¯¼èˆª</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">ğŸ“ è·¯ç”±é…ç½®</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">åŠ¨æ€è·¯ç”±</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">åµŒå¥—è·¯ç”±</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">å‘½åè§†å›¾</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">è·¯ç”±å…ƒä¿¡æ¯</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">ğŸ›¡ï¸ å¯¼èˆªå®ˆå«</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">å…¨å±€å‰ç½®å®ˆå«</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">å…¨å±€è§£æå®ˆå«</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">å…¨å±€åç½®é’©å­</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">è·¯ç”±ç‹¬äº«å®ˆå«</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">ç»„ä»¶å†…å®ˆå«</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id16">ğŸ”„ è·¯ç”±æ‡’åŠ è½½</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id17">åŸºç¡€æ‡’åŠ è½½</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">åˆ†ç»„å’Œé¢„åŠ è½½</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">æ¡ä»¶åŠ è½½</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pinia">ğŸ—„ï¸ Pinia çŠ¶æ€ç®¡ç†</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">å®‰è£…å’Œé…ç½®</a></li>
<li class="toctree-l4"><a class="reference internal" href="#store">å®šä¹‰Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">ä½¿ç”¨Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-api">Options APIé£æ ¼</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">Storeç»„åˆ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pinia-plugin-persistedstate">ä½¿ç”¨pinia-plugin-persistedstate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">æ‰‹åŠ¨æŒä¹…åŒ–</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id25">ğŸ” è·¯ç”±æƒé™æ§åˆ¶</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">æƒé™å®ˆå«</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">åŠ¨æ€è·¯ç”±</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id28">ğŸ“ å®æˆ˜ç¤ºä¾‹</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">è´­ç‰©è½¦Store</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id31">ğŸ¯ æœ€ä½³å®è·µ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../angular/index.html">Angular æ•™ç¨‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typescript/index.html">TypeScript æ•™ç¨‹</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Frontend Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Vue æ•™ç¨‹</a></li>
      <li class="breadcrumb-item active">03-Vue è·¯ç”±ä¸çŠ¶æ€ç®¡ç†</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/vue/03-routing-state.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="vue">
<h1>03-Vue è·¯ç”±ä¸çŠ¶æ€ç®¡ç†<a class="headerlink" href="#vue" title="Link to this heading">ïƒ</a></h1>
<section id="id1">
<h2>ğŸ“‹ å­¦ä¹ ç›®æ ‡<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p>æŒæ¡Vue Router v4çš„ä½¿ç”¨</p></li>
<li><p>ç†è§£è·¯ç”±é…ç½®å’Œå¯¼èˆªå®ˆå«</p></li>
<li><p>å­¦ä¹ PiniaçŠ¶æ€ç®¡ç†</p></li>
<li><p>æŒæ¡è·¯ç”±æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²</p></li>
<li><p>äº†è§£çŠ¶æ€æŒä¹…åŒ–</p></li>
</ul>
</section>
<section id="vue-router">
<h2>ğŸ›£ï¸ Vue Router åŸºç¡€<a class="headerlink" href="#vue-router" title="Link to this heading">ïƒ</a></h2>
<section id="id2">
<h3>å®‰è£…å’Œé…ç½®<a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>vue-router@4
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">createRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">createWebHistory</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Home</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../views/Home.vue&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">About</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../views/About.vue&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Home&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="nx">Home</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/about&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;About&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="nx">About</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createRouter</span><span class="p">({</span>
<span class="w">  </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="nx">createWebHistory</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">routes</span>
<span class="p">});</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// main.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">createApp</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./router&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createApp</span><span class="p">(</span><span class="nx">App</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>è·¯ç”±è§†å›¾å’Œé“¾æ¥<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- App.vue --&gt;</span>
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;app&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&quot;/about&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">router-view</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>ç¼–ç¨‹å¼å¯¼èˆª<a class="headerlink" href="#id4" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">useRoute</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRouter</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRoute</span><span class="p">();</span>

<span class="c1">// å¯¼èˆªåˆ°æŒ‡å®šè·¯ç”±</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">goToAbout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// æˆ–</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;About&#39;</span><span class="p">});</span>
<span class="w">  </span><span class="c1">// æˆ–å¸¦å‚æ•°</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">123</span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// æ›¿æ¢å½“å‰è·¯ç”±</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">replaceRoute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// å‰è¿›/åé€€</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">goBack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">goForward</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">router</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// è·å–å½“å‰è·¯ç”±ä¿¡æ¯</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">query</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="id5">
<h2>ğŸ“ è·¯ç”±é…ç½®<a class="headerlink" href="#id5" title="Link to this heading">ïƒ</a></h2>
<section id="id6">
<h3>åŠ¨æ€è·¯ç”±<a class="headerlink" href="#id6" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/user/:id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/User.vue&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/post/:id(\\d+)&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// åªåŒ¹é…æ•°å­—</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Post&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Post.vue&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/files/:path(.*)&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// åŒ¹é…æ‰€æœ‰è·¯å¾„</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Files&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Files.vue&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- User.vue --&gt;</span>
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>User ID: <span class="cp">{{</span><span class="w"> </span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useRoute</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRoute</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3>åµŒå¥—è·¯ç”±<a class="headerlink" href="#id7" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/user/:id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/User.vue&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserProfile&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/UserProfile.vue&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;posts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserPosts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/UserPosts.vue&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;settings&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserSettings&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/UserSettings.vue&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- User.vue --&gt;</span>
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="p">:</span><span class="na">to</span><span class="o">=</span><span class="s">&quot;</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserProfile&#39;</span><span class="p">}</span><span class="s">&quot;</span><span class="p">&gt;</span>Profile<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="p">:</span><span class="na">to</span><span class="o">=</span><span class="s">&quot;</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserPosts&#39;</span><span class="p">}</span><span class="s">&quot;</span><span class="p">&gt;</span>Posts<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="p">:</span><span class="na">to</span><span class="o">=</span><span class="s">&quot;</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UserSettings&#39;</span><span class="p">}</span><span class="s">&quot;</span><span class="p">&gt;</span>Settings<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">router-view</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3>å‘½åè§†å›¾<a class="headerlink" href="#id8" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">components</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="nx">Home</span><span class="p">,</span>
<span class="w">      </span><span class="nx">sidebar</span><span class="o">:</span><span class="w"> </span><span class="nx">Sidebar</span><span class="p">,</span>
<span class="w">      </span><span class="nx">header</span><span class="o">:</span><span class="w"> </span><span class="nx">Header</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">router-view</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">router-view</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;sidebar&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">router-view</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;header&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id9">
<h3>è·¯ç”±å…ƒä¿¡æ¯<a class="headerlink" href="#id9" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Admin.vue&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">requiresAuth</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">roles</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Admin Panel&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useRoute</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useRoute</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">requiresAuth</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="id10">
<h2>ğŸ›¡ï¸ å¯¼èˆªå®ˆå«<a class="headerlink" href="#id10" title="Link to this heading">ïƒ</a></h2>
<section id="id11">
<h3>å…¨å±€å‰ç½®å®ˆå«<a class="headerlink" href="#id11" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">beforeEach</span><span class="p">((</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// æ£€æŸ¥æ˜¯å¦éœ€è¦è®¤è¯</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">requiresAuth</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">next</span><span class="p">({</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Login&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">redirect</span><span class="o">:</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">fullPath</span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">next</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id12">
<h3>å…¨å±€è§£æå®ˆå«<a class="headerlink" href="#id12" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">router</span><span class="p">.</span><span class="nx">beforeResolve</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// åœ¨å¯¼èˆªè¢«ç¡®è®¤ä¹‹å‰ï¼ŒåŒæ—¶è§£æå®Œæ‰€æœ‰å¼‚æ­¥ç»„ä»¶</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">requiresData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id13">
<h3>å…¨å±€åç½®é’©å­<a class="headerlink" href="#id13" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">router</span><span class="p">.</span><span class="nx">afterEach</span><span class="p">((</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// è®¾ç½®é¡µé¢æ ‡é¢˜</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;My App&#39;</span><span class="p">;</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// å‘é€é¡µé¢æµè§ˆç»Ÿè®¡</span>
<span class="w">  </span><span class="nx">analytics</span><span class="p">.</span><span class="nx">track</span><span class="p">(</span><span class="s1">&#39;page_view&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">name</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id14">
<h3>è·¯ç”±ç‹¬äº«å®ˆå«<a class="headerlink" href="#id14" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Admin.vue&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">beforeEnter</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasPermission</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">next</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">next</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Forbidden&#39;</span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3>ç»„ä»¶å†…å®ˆå«<a class="headerlink" href="#id15" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">onBeforeRouteLeave</span><span class="p">,</span><span class="w"> </span><span class="nx">onBeforeRouteUpdate</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>

<span class="c1">// ç¦»å¼€å®ˆå«</span>
<span class="nx">onBeforeRouteLeave</span><span class="p">((</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">answer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// å–æ¶ˆå¯¼èˆª</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// æ›´æ–°å®ˆå«</span>
<span class="nx">onBeforeRouteUpdate</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// è·¯ç”±å‚æ•°å˜åŒ–æ—¶é‡æ–°è·å–æ•°æ®</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchUserData</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="id16">
<h2>ğŸ”„ è·¯ç”±æ‡’åŠ è½½<a class="headerlink" href="#id16" title="Link to this heading">ïƒ</a></h2>
<section id="id17">
<h3>åŸºç¡€æ‡’åŠ è½½<a class="headerlink" href="#id17" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/home&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Home.vue&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
</section>
<section id="id18">
<h3>åˆ†ç»„å’Œé¢„åŠ è½½<a class="headerlink" href="#id18" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span>
<span class="w">      </span><span class="cm">/* webpackChunkName: &quot;admin&quot; */</span>
<span class="w">      </span><span class="s1">&#39;../views/Admin.vue&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/user&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span>
<span class="w">      </span><span class="cm">/* webpackChunkName: &quot;user&quot; */</span>
<span class="w">      </span><span class="s1">&#39;../views/User.vue&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
</section>
<section id="id19">
<h3>æ¡ä»¶åŠ è½½<a class="headerlink" href="#id19" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">lazyLoad</span><span class="p">(</span><span class="nx">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="sb">`../views/</span><span class="si">${</span><span class="nx">view</span><span class="si">}</span><span class="sb">.vue`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/home&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="nx">lazyLoad</span><span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
</section>
</section>
<section id="pinia">
<h2>ğŸ—„ï¸ Pinia çŠ¶æ€ç®¡ç†<a class="headerlink" href="#pinia" title="Link to this heading">ïƒ</a></h2>
<section id="id20">
<h3>å®‰è£…å’Œé…ç½®<a class="headerlink" href="#id20" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>pinia
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// main.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">createApp</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">createPinia</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createApp</span><span class="p">(</span><span class="nx">App</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">createPinia</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="store">
<h3>å®šä¹‰Store<a class="headerlink" href="#store" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/user.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">defineStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="nx">computed</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useUserStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// State</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// Getters</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isAuthenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computed</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!!</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computed</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Guest&#39;</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// Actions</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">api</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
<span class="w">      </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">logout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span>
<span class="w">    </span><span class="nx">token</span><span class="p">,</span>
<span class="w">    </span><span class="nx">isAuthenticated</span><span class="p">,</span>
<span class="w">    </span><span class="nx">userName</span><span class="p">,</span>
<span class="w">    </span><span class="nx">login</span><span class="p">,</span>
<span class="w">    </span><span class="nx">logout</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id21">
<h3>ä½¿ç”¨Store<a class="headerlink" href="#id21" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useUserStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/stores/user&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">storeToRefs</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">userStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useUserStore</span><span class="p">();</span>

<span class="c1">// ç›´æ¥è§£æ„ä¼šå¤±å»å“åº”å¼</span>
<span class="c1">// const {user, token} = userStore; // âŒ</span>

<span class="c1">// ä½¿ç”¨storeToRefsä¿æŒå“åº”å¼</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">isAuthenticated</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">storeToRefs</span><span class="p">(</span><span class="nx">userStore</span><span class="p">);</span>

<span class="c1">// Actionså¯ä»¥ç›´æ¥è§£æ„</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">login</span><span class="p">,</span><span class="w"> </span><span class="nx">logout</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">userStore</span><span class="p">;</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">handleLogin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">login</span><span class="p">({</span>
<span class="w">    </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&quot;</span><span class="nx">isAuthenticated</span><span class="s">&quot;</span><span class="p">&gt;</span>Welcome, <span class="cp">{{</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="p">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;</span><span class="nx">handleLogin</span><span class="s">&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="p">@</span><span class="na">click</span><span class="o">=</span><span class="s">&quot;</span><span class="nx">logout</span><span class="s">&quot;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="options-api">
<h3>Options APIé£æ ¼<a class="headerlink" href="#options-api" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/counter.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">defineStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useCounterStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Counter&#39;</span>
<span class="w">  </span><span class="p">}),</span>
<span class="w">  </span>
<span class="w">  </span><span class="nx">getters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">doubleCount</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="nx">doubleCountPlusOne</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">doubleCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span>
<span class="w">  </span><span class="nx">actions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">api</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id22">
<h3>Storeç»„åˆ<a class="headerlink" href="#id22" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/cart.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">defineStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useUserStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./user&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useCartStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useUserStore</span><span class="p">();</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">([]);</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">addItem</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userStore</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Please login first&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">items</span><span class="p">,</span>
<span class="w">    </span><span class="nx">addItem</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
</section>
<section id="id23">
<h2>ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–<a class="headerlink" href="#id23" title="Link to this heading">ïƒ</a></h2>
<section id="pinia-plugin-persistedstate">
<h3>ä½¿ç”¨pinia-plugin-persistedstate<a class="headerlink" href="#pinia-plugin-persistedstate" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install<span class="w"> </span>pinia-plugin-persistedstate
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// main.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">createPinia</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">piniaPluginPersistedstate</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia-plugin-persistedstate&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">pinia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPinia</span><span class="p">();</span>
<span class="nx">pinia</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">piniaPluginPersistedstate</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/user.js</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useUserStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span>
<span class="w">    </span><span class="nx">token</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">persist</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user-store&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">storage</span><span class="o">:</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">,</span>
<span class="w">    </span><span class="nx">paths</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span><span class="w"> </span><span class="c1">// åªæŒä¹…åŒ–token</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id24">
<h3>æ‰‹åŠ¨æŒä¹…åŒ–<a class="headerlink" href="#id24" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/user.js</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useUserStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span>
<span class="w">    </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">saveToStorage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">api</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
<span class="w">      </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
<span class="w">      </span><span class="nx">saveToStorage</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span>
<span class="w">    </span><span class="nx">token</span><span class="p">,</span>
<span class="w">    </span><span class="nx">login</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
</section>
<section id="id25">
<h2>ğŸ” è·¯ç”±æƒé™æ§åˆ¶<a class="headerlink" href="#id25" title="Link to this heading">ïƒ</a></h2>
<section id="id26">
<h3>æƒé™å®ˆå«<a class="headerlink" href="#id26" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">useUserStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/stores/user&#39;</span><span class="p">;</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">beforeEach</span><span class="p">((</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useUserStore</span><span class="p">();</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// æ£€æŸ¥è®¤è¯</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">requiresAuth</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">userStore</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">next</span><span class="p">({</span>
<span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Login&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">redirect</span><span class="o">:</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">fullPath</span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// æ£€æŸ¥è§’è‰²</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">roles</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">to</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">roles</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">userStore</span><span class="p">.</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">role</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">next</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Forbidden&#39;</span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id27">
<h3>åŠ¨æ€è·¯ç”±<a class="headerlink" href="#id27" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// router/index.js</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">setupRouter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">userStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useUserStore</span><span class="p">();</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// æ ¹æ®æƒé™åŠ¨æ€æ·»åŠ è·¯ç”±</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userStore</span><span class="p">.</span><span class="nx">hasPermission</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">addRoute</span><span class="p">({</span>
<span class="w">      </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">component</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;../views/Admin.vue&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id28">
<h2>ğŸ“ å®æˆ˜ç¤ºä¾‹<a class="headerlink" href="#id28" title="Link to this heading">ïƒ</a></h2>
<section id="id29">
<h3>å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹<a class="headerlink" href="#id29" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/auth.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">defineStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/router&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAuthStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">api</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">credentials</span><span class="p">);</span>
<span class="w">      </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
<span class="w">      </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
<span class="w">      </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// é‡å®šå‘åˆ°åŸé¡µé¢æˆ–é¦–é¡µ</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">redirect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">router</span><span class="p">.</span><span class="nx">currentRoute</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">redirect</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">redirect</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">logout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">checkAuth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">api</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
<span class="w">      </span><span class="nx">user</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">logout</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span>
<span class="w">    </span><span class="nx">token</span><span class="p">,</span>
<span class="w">    </span><span class="nx">login</span><span class="p">,</span>
<span class="w">    </span><span class="nx">logout</span><span class="p">,</span>
<span class="w">    </span><span class="nx">checkAuth</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id30">
<h3>è´­ç‰©è½¦Store<a class="headerlink" href="#id30" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// stores/cart.js</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">defineStore</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="nx">computed</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useCartStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;cart&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ref</span><span class="p">([]);</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computed</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">computed</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">addItem</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">existingItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">existingItem</span><span class="p">.</span><span class="nx">quantity</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
<span class="w">        </span><span class="p">...</span><span class="nx">product</span><span class="p">,</span>
<span class="w">        </span><span class="nx">quantity</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">productId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">updateQuantity</span><span class="p">(</span><span class="nx">productId</span><span class="p">,</span><span class="w"> </span><span class="nx">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">productId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">item</span><span class="p">.</span><span class="nx">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">clearCart</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">items</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">items</span><span class="p">,</span>
<span class="w">    </span><span class="nx">totalPrice</span><span class="p">,</span>
<span class="w">    </span><span class="nx">itemCount</span><span class="p">,</span>
<span class="w">    </span><span class="nx">addItem</span><span class="p">,</span>
<span class="w">    </span><span class="nx">removeItem</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updateQuantity</span><span class="p">,</span>
<span class="w">    </span><span class="nx">clearCart</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">persist</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
</section>
<section id="id31">
<h2>ğŸ¯ æœ€ä½³å®è·µ<a class="headerlink" href="#id31" title="Link to this heading">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>è·¯ç”±æ‡’åŠ è½½</strong>ï¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥å‡å°‘åˆå§‹åŒ…å¤§å°</p></li>
<li><p><strong>è·¯ç”±å®ˆå«</strong>ï¼šç»Ÿä¸€å¤„ç†æƒé™å’Œè®¤è¯é€»è¾‘</p></li>
<li><p><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šå¤æ‚çŠ¶æ€ä½¿ç”¨Piniaï¼Œç®€å•çŠ¶æ€ä½¿ç”¨ç»„ä»¶å†…çŠ¶æ€</p></li>
<li><p><strong>çŠ¶æ€æŒä¹…åŒ–</strong>ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼Œéæ•æ„Ÿæ•°æ®ä½¿ç”¨localStorage</p></li>
<li><p><strong>ç±»å‹å®‰å…¨</strong>ï¼šä½¿ç”¨TypeScriptå®šä¹‰è·¯ç”±å’ŒStoreç±»å‹</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="é¡µè„š">
        <a href="02-component-system.html" class="btn btn-neutral float-left" title="02-Vue ç»„ä»¶ç³»ç»Ÿä¸é€šä¿¡" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> ä¸Šä¸€é¡µ</a>
        <a href="../angular/index.html" class="btn btn-neutral float-right" title="Angular æ•™ç¨‹" accesskey="n" rel="next">ä¸‹ä¸€é¡µ <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2025, Code Dojoã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>