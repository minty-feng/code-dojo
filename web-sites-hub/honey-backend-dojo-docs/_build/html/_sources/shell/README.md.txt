# ğŸ’» Shell å¼€å‘

Shellæ˜¯Linux/Unixç³»ç»Ÿçš„å‘½ä»¤è§£é‡Šå™¨å’Œè„šæœ¬è¯­è¨€ï¼Œè¿ç»´è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒå·¥å…·ã€‚

## å­¦ä¹ æ—¶é—´çº¿

**2020å¹´6æœˆ - 2020å¹´10æœˆï¼ˆ5ä¸ªæœˆï¼‰**

### é˜¶æ®µä¸€ï¼šShellåŸºç¡€ï¼ˆ2020-06ï¼‰
- Shellç±»å‹ï¼ˆBashã€Zshï¼‰
- å˜é‡ã€æ•°æ®ç±»å‹ã€è¿ç®—ç¬¦
- æµç¨‹æ§åˆ¶ã€å‡½æ•°
- è¾“å…¥è¾“å‡ºã€é‡å®šå‘

### é˜¶æ®µäºŒï¼šæ–‡æœ¬å¤„ç†ï¼ˆ2020-07ï¼‰
- grepï¼šæ–‡æœ¬æœç´¢
- sedï¼šæµç¼–è¾‘å™¨
- awkï¼šæ–‡æœ¬åˆ†æ
- ä¸‰å‰‘å®¢ç»„åˆä½¿ç”¨

### é˜¶æ®µä¸‰ï¼šå®æˆ˜åº”ç”¨ï¼ˆ2020-09ï¼‰
- ç³»ç»Ÿç›‘æ§è„šæœ¬
- æ—¥å¿—åˆ†æè„šæœ¬
- å¤‡ä»½è„šæœ¬
- æ‰¹é‡å¤„ç†è„šæœ¬
- éƒ¨ç½²è‡ªåŠ¨åŒ–

## å­¦ä¹ æ–‡æ¡£

1. **01-ShellåŸºç¡€.md** - Shellè¯­æ³•ã€å˜é‡ã€æµç¨‹æ§åˆ¶ã€å‡½æ•°
2. **02-æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢.md** - grepã€sedã€awkè¯¦è§£
3. **03-å®ç”¨è„šæœ¬.md** - ç³»ç»Ÿç®¡ç†ã€æ—¥å¿—åˆ†æã€å¤‡ä»½éƒ¨ç½²

## Shellæ ¸å¿ƒç‰¹æ€§

### è¯­è¨€ç‰¹æ€§
- **ç®€å•è¯­æ³•**ï¼šæ˜“å­¦æ˜“ç”¨ï¼Œå¿«é€Ÿç¼–å†™è„šæœ¬
- **å‘½ä»¤é›†æˆ**ï¼šç›´æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤
- **ç®¡é“æœºåˆ¶**ï¼šå‘½ä»¤ç»„åˆï¼ŒåŠŸèƒ½å¼ºå¤§
- **æ­£åˆ™è¡¨è¾¾å¼**ï¼šæ–‡æœ¬å¤„ç†èƒ½åŠ›å¼º
- **è¿›ç¨‹æ§åˆ¶**ï¼šåå°ä»»åŠ¡ã€ä¿¡å·å¤„ç†

### æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢
- **grep**ï¼šæœç´¢è¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…
- **sed**ï¼šæµç¼–è¾‘ï¼Œæ›¿æ¢åˆ é™¤
- **awk**ï¼šåˆ†æç»Ÿè®¡ï¼Œåˆ—å¤„ç†

### åº”ç”¨åœºæ™¯
- **ç³»ç»Ÿè¿ç»´**ï¼šç›‘æ§ã€å·¡æ£€ã€å‘Šè­¦
- **æ—¥å¿—åˆ†æ**ï¼šç»Ÿè®¡ã€è¿‡æ»¤ã€æŠ¥è¡¨
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šCI/CDæµç¨‹
- **æ‰¹é‡å¤„ç†**ï¼šæ–‡ä»¶æ“ä½œã€æ ¼å¼è½¬æ¢
- **å®šæ—¶ä»»åŠ¡**ï¼šå¤‡ä»½ã€æ¸…ç†ã€åŒæ­¥

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### æ–‡ä»¶æ“ä½œ
```bash
ls, cd, pwd, mkdir, rm, cp, mv
cat, head, tail, less, more
find, locate, which, whereis
chmod, chown, chgrp
tar, gzip, zip, unzip
```

### æ–‡æœ¬å¤„ç†
```bash
grep, egrep, fgrep
sed
awk
cut, sort, uniq, wc
tr, diff, patch
```

### ç³»ç»Ÿç®¡ç†
```bash
ps, top, htop, kill
systemctl, service
df, du, free
netstat, ss, lsof
crontab, at
```

### ç½‘ç»œå·¥å…·
```bash
ping, traceroute, nslookup
curl, wget
ssh, scp, rsync
nc, telnet
```

## é¡¹ç›®å®è·µ

### å¸¸ç”¨è„šæœ¬ç±»å‹
1. **ç›‘æ§è„šæœ¬** - CPUã€å†…å­˜ã€ç£ç›˜ã€æœåŠ¡ç›‘æ§
2. **æ—¥å¿—åˆ†æ** - è®¿é—®æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ç»Ÿè®¡
3. **å¤‡ä»½è„šæœ¬** - æ•°æ®åº“å¤‡ä»½ã€æ–‡ä»¶åŒæ­¥
4. **éƒ¨ç½²è„šæœ¬** - åº”ç”¨éƒ¨ç½²ã€å®¹å™¨ç®¡ç†
5. **æ‰¹å¤„ç†** - æ–‡ä»¶é‡å‘½åã€æ ¼å¼è½¬æ¢

### è„šæœ¬æ¨¡æ¿
```bash
#!/usr/bin/env bash

set -euo pipefail  # ä¸¥æ ¼æ¨¡å¼

readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly LOG_FILE="/var/log/script.log"

log() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] $*" | tee -a "$LOG_FILE"
}

cleanup() {
    log "æ¸…ç†èµ„æº..."
}

trap cleanup EXIT

main() {
    log "å¼€å§‹æ‰§è¡Œ..."
    # ä¸»é€»è¾‘
}

main "$@"
```

## æœ€ä½³å®è·µ

### è„šæœ¬è§„èŒƒ
1. **Shebang**ï¼š`#!/usr/bin/env bash`
2. **ä¸¥æ ¼æ¨¡å¼**ï¼š`set -euo pipefail`
3. **å˜é‡å¼•ç”¨**ï¼š`"$var"` è€Œä¸æ˜¯ `$var`
4. **å‡½æ•°åˆ†è§£**ï¼šé€»è¾‘æ¸…æ™°ï¼Œå•ä¸€èŒè´£
5. **é”™è¯¯å¤„ç†**ï¼šæ£€æŸ¥å‘½ä»¤è¿”å›å€¼
6. **æ—¥å¿—è®°å½•**ï¼šå…³é”®æ“ä½œç•™ç—•
7. **å‚æ•°æ ¡éªŒ**ï¼šæ£€æŸ¥è¾“å…¥æœ‰æ•ˆæ€§

### å˜é‡å‘½å
```bash
# å°å†™ï¼šå±€éƒ¨å˜é‡
local_var="value"

# å¤§å†™ï¼šç¯å¢ƒå˜é‡/å¸¸é‡
readonly MAX_COUNT=100
export PATH=$PATH:/usr/local/bin

# æ˜ç¡®å¼•ç”¨
"${var}"                # æ¨è
"${var:-default}"       # é»˜è®¤å€¼
"${var:?error}"         # æœªå®šä¹‰æŠ¥é”™
"${var/old/new}"        # æ›¿æ¢
```

### é”™è¯¯å¤„ç†
```bash
# æ£€æŸ¥å‘½ä»¤å­˜åœ¨
if ! command -v git &> /dev/null; then
    echo "git æœªå®‰è£…"
    exit 1
fi

# æ£€æŸ¥æ–‡ä»¶
if [ ! -f "$file" ]; then
    echo "æ–‡ä»¶ä¸å­˜åœ¨: $file"
    exit 1
fi

# æ£€æŸ¥å‘½ä»¤çŠ¶æ€
if ! some_command; then
    echo "å‘½ä»¤å¤±è´¥"
    exit 1
fi

# æ•è·é”™è¯¯è¡Œå·
trap 'echo "é”™è¯¯åœ¨ç¬¬ $LINENO è¡Œ"' ERR
```

### æ€§èƒ½ä¼˜åŒ–
```bash
# é¿å…ä¸å¿…è¦çš„ç®¡é“
# âŒ æ…¢
cat file | grep pattern

# âœ… å¿«
grep pattern file

# ä½¿ç”¨å†…å»ºå‘½ä»¤
# âŒ æ…¢ï¼ˆå¤–éƒ¨å‘½ä»¤ï¼‰
result=$(basename "$path")

# âœ… å¿«ï¼ˆå‚æ•°æ‰©å±•ï¼‰
result="${path##*/}"

# æ‰¹é‡å¤„ç†ç”¨while
# âŒ æ…¢ï¼ˆæ¯æ¬¡forkï¼‰
for line in $(cat file); do
    process "$line"
done

# âœ… å¿«ï¼ˆç®¡é“ï¼‰
while IFS= read -r line; do
    process "$line"
done < file
```

## è°ƒè¯•æŠ€å·§

### è°ƒè¯•é€‰é¡¹
```bash
bash -x script.sh      # æ‰“å°æ‰§è¡Œå‘½ä»¤
bash -n script.sh      # æ£€æŸ¥è¯­æ³•
bash -v script.sh      # æ‰“å°åŸå§‹å‘½ä»¤

# è„šæœ¬å†…æ§åˆ¶
set -x  # å¼€å¯
set +x  # å…³é—­
```

### è°ƒè¯•å‡½æ•°
```bash
debug() {
    [ "$DEBUG" = "1" ] && echo "DEBUG: $*" >&2
}

# ä½¿ç”¨
DEBUG=1 ./script.sh
```

### ShellCheck
```bash
# å®‰è£…é™æ€åˆ†æå·¥å…·
apt install shellcheck

# æ£€æŸ¥è„šæœ¬
shellcheck script.sh

# å¿½ç•¥ç‰¹å®šè§„åˆ™
# shellcheck disable=SC2086
```

## grepã€sedã€awké€‰æ‹©

### ä½¿ç”¨åœºæ™¯
| ä»»åŠ¡ | å·¥å…· | ç†ç”± |
|------|------|------|
| æœç´¢è¿‡æ»¤ | grep | ä¸“ç”¨ï¼Œæœ€å¿« |
| ç®€å•æ›¿æ¢ | sed | æµç¼–è¾‘ä¸“ç”¨ |
| åˆ—å¤„ç† | awk | åˆ—å¤„ç†æœ€å¼º |
| ç»Ÿè®¡è®¡ç®— | awk | æ”¯æŒå˜é‡æ•°ç»„ |
| å¤æ‚é€»è¾‘ | awk | æ¥è¿‘ç¼–ç¨‹è¯­è¨€ |

### ç»„åˆä½¿ç”¨
```bash
# å…¸å‹æµç¨‹
grep "pattern" file.log |    # è¿‡æ»¤
    sed 's/old/new/g' |       # æ›¿æ¢
    awk '{print $1, $3}' |    # æå–åˆ—
    sort | uniq -c             # ç»Ÿè®¡

# é¿å…ä¸å¿…è¦çš„ç®¡é“
# âŒ
grep "pattern" file | awk '{print $1}'

# âœ…
awk '/pattern/ {print $1}' file
```

## å¸¸è§é™·é˜±

### 1. å˜é‡ä¸åŠ å¼•å·
```bash
# âŒ å˜é‡åŒ…å«ç©ºæ ¼ä¼šå‡ºé”™
rm $file

# âœ…
rm "$file"
```

### 2. æ¯”è¾ƒè¿ç®—ç¬¦æ··æ·†
```bash
# âŒ å­—ç¬¦ä¸²æ¯”è¾ƒç”¨æ•°å€¼è¿ç®—ç¬¦
[ "$str" -eq "value" ]

# âœ…
[ "$str" = "value" ]
```

### 3. ç®¡é“ä¸­å˜é‡ä½œç”¨åŸŸ
```bash
# âŒ ç®¡é“åˆ›å»ºå­shellï¼Œcountä¸ç”Ÿæ•ˆ
count=0
cat file | while read line; do
    ((count++))
done
echo $count  # 0

# âœ…
count=0
while read line; do
    ((count++))
done < file
echo $count  # æ­£ç¡®
```

### 4. æ–‡ä»¶åä¸­çš„ç©ºæ ¼
```bash
# âŒ
for file in $(ls *.txt); do
    process $file
done

# âœ…
while IFS= read -r -d '' file; do
    process "$file"
done < <(find . -name "*.txt" -print0)
```

## å­¦ä¹ èµ„æº

### åœ¨çº¿èµ„æº
- Bashå®˜æ–¹æ‰‹å†Œï¼šhttps://www.gnu.org/software/bash/manual/
- Advanced Bash-Scripting Guide
- ShellCheckï¼šhttps://www.shellcheck.net/
- Explain Shellï¼šhttps://explainshell.com/

### æ¨èä¹¦ç±
- ã€ŠLinuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹
- ã€Šsedä¸awkã€‹
- ã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‹

### ç»ƒä¹ å¹³å°
- HackerRank Shell
- LeetCode Shellé¢˜ç›®
- å®é™…ç”Ÿäº§ç¯å¢ƒé—®é¢˜

## åº”ç”¨é¢†åŸŸ

### DevOps
- CI/CDè„šæœ¬
- è‡ªåŠ¨åŒ–éƒ¨ç½²
- é…ç½®ç®¡ç†
- å®¹å™¨ç®¡ç†

### è¿ç»´
- ç³»ç»Ÿç›‘æ§
- æ—¥å¿—åˆ†æ
- å¤‡ä»½æ¢å¤
- å‘Šè­¦é€šçŸ¥

### æ•°æ®å¤„ç†
- æ—¥å¿—æ¸…æ´—
- æ ¼å¼è½¬æ¢
- ç»Ÿè®¡åˆ†æ
- æŠ¥è¡¨ç”Ÿæˆ

## å­¦ä¹ å¿ƒå¾—

1. **å®ç”¨ä¸»ä¹‰**ï¼šShellé‡åœ¨è§£å†³å®é™…é—®é¢˜
2. **ç®€æ´ä¸ºç¾**ï¼šå¤æ‚é€»è¾‘ç”¨Pythonç­‰å…¶ä»–è¯­è¨€
3. **ä¸‰å‰‘å®¢å¿…ä¼š**ï¼šgrep/sed/awkæ˜¯æ ¸å¿ƒæŠ€èƒ½
4. **ç®¡é“æ€ç»´**ï¼šç»„åˆç®€å•å‘½ä»¤å®ç°å¤æ‚åŠŸèƒ½
5. **é”™è¯¯å¤„ç†**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸¥è°¨
6. **æ—¥å¿—è®°å½•**ï¼šå…³é”®æ“ä½œå¯è¿½æº¯
7. **æ¨¡æ¿å¤ç”¨**ï¼šå»ºç«‹å¸¸ç”¨è„šæœ¬åº“
8. **æŒç»­å­¦ä¹ **ï¼šæ–°å·¥å…·æ–°ç‰¹æ€§ä¸æ–­æ¶Œç°
9. **å®è·µä¸ºä¸»**ï¼šçœ‹åƒéä¸å¦‚æ‰‹å†™ä¸€é
10. **ä»£ç å®¡æŸ¥**ï¼šç”¨ShellCheckæ£€æŸ¥è§„èŒƒ

**æ ¸å¿ƒï¼š** Shellæ˜¯Linuxè¿ç»´çš„åŸºæœ¬åŠŸï¼ŒæŒæ¡åŸºç¡€è¯­æ³•å’Œä¸‰å‰‘å®¢å¯è§£å†³å¤§éƒ¨åˆ†å®é™…é—®é¢˜ã€‚å¤æ‚é€»è¾‘å»ºè®®ç”¨Python/Goç­‰è¯­è¨€ã€‚

