

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>02-文本处理三剑客：grep、sed、awk &mdash; Backend Tutorial 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2d0851c8" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/copy-code.js?v=caf91246"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="03-Shell实用脚本" href="03-scripts.html" />
    <link rel="prev" title="01-Shell基础" href="01-basics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            Backend Tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Backend Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/index.html">C++ 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java/index.html">Java 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodejs/index.html">Node.js 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/index.html">Golang 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust 教程</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Shell 教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Shell 开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="01-basics.html">01-Shell基础</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">02-文本处理三剑客：grep、sed、awk</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#grep">grep - 文本搜索</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">基本用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">正则表达式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">实战案例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">grep变体</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sed">sed - 流编辑器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">基本语法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#s">替换（s命令）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d">删除（d命令）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">插入和追加</a></li>
<li class="toctree-l4"><a class="reference internal" href="#p">打印（p命令）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">多命令和分支</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">实战案例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">sed高级技巧</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#awk">awk - 文本分析</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">基本语法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">基本用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">模式匹配</a></li>
<li class="toctree-l4"><a class="reference internal" href="#beginend">BEGIN和END</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">运算和变量</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">格式化输出</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">条件和循环</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">实战案例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">awk脚本文件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id19">三剑客组合使用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">管道组合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">实战脚本</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id22">性能对比</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">最佳实践</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id24">选择工具</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">性能优化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">可读性</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03-scripts.html">03-Shell实用脚本</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Backend Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Shell 教程</a></li>
      <li class="breadcrumb-item active">02-文本处理三剑客：grep、sed、awk</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/shell/02-text-processing.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="grepsedawk">
<h1>02-文本处理三剑客：grep、sed、awk<a class="headerlink" href="#grepsedawk" title="Permalink to this heading"></a></h1>
<p>Linux文本处理三剑客：grep查找、sed编辑、awk分析。掌握这三个工具可解决90%的文本处理需求。</p>
<section id="grep">
<h2>grep - 文本搜索<a class="headerlink" href="#grep" title="Permalink to this heading"></a></h2>
<p>grep（Global Regular Expression Print）用于搜索文本，支持正则表达式。</p>
<section id="id1">
<h3>基本用法<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 基本搜索</span>
grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 忽略大小写</span>
grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 显示行号</span>
grep<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 反向匹配（不包含）</span>
grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 递归搜索目录</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>/path/to/dir

<span class="c1"># 只显示文件名</span>
grep<span class="w"> </span>-l<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>*.txt

<span class="c1"># 显示匹配行的上下文</span>
grep<span class="w"> </span>-C<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 前后各3行</span>
grep<span class="w"> </span>-A<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 后2行</span>
grep<span class="w"> </span>-B<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 前2行</span>

<span class="c1"># 统计匹配行数</span>
grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 精确匹配整行</span>
grep<span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;exact line&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 匹配整个单词</span>
grep<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;word&quot;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id2">
<h3>正则表达式<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 基本正则表达式（BRE）</span>
grep<span class="w"> </span><span class="s2">&quot;^start&quot;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 行首</span>
grep<span class="w"> </span><span class="s2">&quot;end</span>$<span class="s2">&quot;</span><span class="w"> </span>file.txt<span class="w">       </span><span class="c1"># 行尾</span>
grep<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 空行</span>
grep<span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 任意字符</span>
grep<span class="w"> </span><span class="s2">&quot;a*&quot;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 0个或多个a</span>
grep<span class="w"> </span><span class="s2">&quot;[abc]&quot;</span><span class="w"> </span>file.txt<span class="w">      </span><span class="c1"># a、b或c</span>
grep<span class="w"> </span><span class="s2">&quot;[^abc]&quot;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 非a、b、c</span>
grep<span class="w"> </span><span class="s2">&quot;[0-9]&quot;</span><span class="w"> </span>file.txt<span class="w">      </span><span class="c1"># 数字</span>
grep<span class="w"> </span><span class="s2">&quot;[a-z]&quot;</span><span class="w"> </span>file.txt<span class="w">      </span><span class="c1"># 小写字母</span>

<span class="c1"># 扩展正则表达式（ERE，-E）</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;a+&quot;</span><span class="w"> </span>file.txt<span class="w">      </span><span class="c1"># 1个或多个a</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;a?&quot;</span><span class="w"> </span>file.txt<span class="w">      </span><span class="c1"># 0个或1个a</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;a{3}&quot;</span><span class="w"> </span>file.txt<span class="w">    </span><span class="c1"># 恰好3个a</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;a{2,5}&quot;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 2-5个a</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;a{2,}&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 至少2个a</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;ab|cd&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># ab或cd</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(ab)+&quot;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 1个或多个ab</span>

<span class="c1"># Perl正则（-P，功能最强）</span>
grep<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;\d+&quot;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 数字</span>
grep<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;\w+&quot;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 字母数字下划线</span>
grep<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;\s+&quot;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 空白字符</span>
grep<span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;(?&lt;=@)\w+&quot;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 正向后查找</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>实战案例<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查找IP地址</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 查找邮箱</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 查找URL</span>
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;https?://[^\s]+&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 查找ERROR日志</span>
grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="w"> </span>/var/log/syslog

<span class="c1"># 排除注释行和空行</span>
grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^#&quot;</span><span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span>

<span class="c1"># 多模式搜索</span>
grep<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;pattern1&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;pattern2&quot;</span><span class="w"> </span>file.txt
grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;pattern1|pattern2&quot;</span><span class="w"> </span>file.txt

<span class="c1"># 从文件读取模式</span>
grep<span class="w"> </span>-f<span class="w"> </span>patterns.txt<span class="w"> </span>file.txt

<span class="c1"># 统计代码行（排除空行和注释）</span>
grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span><span class="w"> </span>file.c<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^\s*//&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l

<span class="c1"># 查找进程</span>
ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>grep

<span class="c1"># 彩色高亮（默认）</span>
grep<span class="w"> </span>--color<span class="o">=</span>auto<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id4">
<h3>grep变体<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># egrep = grep -E（扩展正则）</span>
egrep<span class="w"> </span><span class="s2">&quot;a+&quot;</span><span class="w"> </span>file.txt

<span class="c1"># fgrep = grep -F（固定字符串，不解析正则）</span>
fgrep<span class="w"> </span><span class="s2">&quot;a*b&quot;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 搜索字面量 &quot;a*b&quot;</span>

<span class="c1"># zgrep（搜索压缩文件）</span>
zgrep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span>file.gz
</pre></div>
</div>
</section>
</section>
<section id="sed">
<h2>sed - 流编辑器<a class="headerlink" href="#sed" title="Permalink to this heading"></a></h2>
<p>sed（Stream Editor）逐行处理文本，支持查找、替换、删除、插入。</p>
<section id="id5">
<h3>基本语法<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span><span class="s1">&#39;command&#39;</span><span class="w"> </span>file

<span class="c1"># -n：静默模式（只打印处理的行）</span>
<span class="c1"># -e：多个编辑命令</span>
<span class="c1"># -i：原地编辑（修改文件）</span>
<span class="c1"># -r/-E：扩展正则</span>
</pre></div>
</div>
</section>
<section id="s">
<h3>替换（s命令）<a class="headerlink" href="#s" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 基本替换（只替换每行第一个）</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 全局替换（每行所有匹配）</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 替换第N个匹配</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/2&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 第2个</span>

<span class="c1"># 忽略大小写</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/gi&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 替换特定行</span>
sed<span class="w"> </span><span class="s1">&#39;3s/old/new/&#39;</span><span class="w"> </span>file.txt<span class="w">       </span><span class="c1"># 第3行</span>
sed<span class="w"> </span><span class="s1">&#39;2,5s/old/new/&#39;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 2-5行</span>
sed<span class="w"> </span><span class="s1">&#39;2,$s/old/new/&#39;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># 2到末尾</span>
sed<span class="w"> </span><span class="s1">&#39;/pattern/s/old/new/&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 匹配pattern的行</span>

<span class="c1"># 原地修改文件</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 备份后修改</span>
sed<span class="w"> </span>-i.bak<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 分隔符替换（避免转义/）</span>
sed<span class="w"> </span><span class="s1">&#39;s|/usr/bin|/usr/local/bin|g&#39;</span><span class="w"> </span>file.txt
sed<span class="w"> </span><span class="s1">&#39;s#old#new#g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 使用正则</span>
sed<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;s/[0-9]+/NUMBER/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 引用匹配内容（&amp;）</span>
sed<span class="w"> </span><span class="s1">&#39;s/[0-9]\+/&quot;&amp;&quot;/g&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 123 → &quot;123&quot;</span>

<span class="c1"># 引用分组（\1, \2...）</span>
sed<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;s/([a-z]+)@([a-z]+)/\2@\1/&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># user@host → host@user</span>
</pre></div>
</div>
</section>
<section id="d">
<h3>删除（d命令）<a class="headerlink" href="#d" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 删除特定行</span>
sed<span class="w"> </span><span class="s1">&#39;3d&#39;</span><span class="w"> </span>file.txt<span class="w">           </span><span class="c1"># 第3行</span>
sed<span class="w"> </span><span class="s1">&#39;2,5d&#39;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 2-5行</span>
sed<span class="w"> </span><span class="s1">&#39;2,$d&#39;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 2到末尾</span>
sed<span class="w"> </span><span class="s1">&#39;$d&#39;</span><span class="w"> </span>file.txt<span class="w">           </span><span class="c1"># 最后一行</span>

<span class="c1"># 删除匹配行</span>
sed<span class="w"> </span><span class="s1">&#39;/pattern/d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 删除空行</span>
sed<span class="w"> </span><span class="s1">&#39;/^$/d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 删除注释行</span>
sed<span class="w"> </span><span class="s1">&#39;/^#/d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 删除空行和注释</span>
sed<span class="w"> </span><span class="s1">&#39;/^$/d; /^#/d&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id6">
<h3>插入和追加<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># a：在后面追加</span>
sed<span class="w"> </span><span class="s1">&#39;2a\new line&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 第2行后</span>
sed<span class="w"> </span><span class="s1">&#39;/pattern/a\new line&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 匹配行后</span>

<span class="c1"># i：在前面插入</span>
sed<span class="w"> </span><span class="s1">&#39;2i\new line&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 第2行前</span>
sed<span class="w"> </span><span class="s1">&#39;/pattern/i\new line&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 匹配行前</span>

<span class="c1"># c：替换整行</span>
sed<span class="w"> </span><span class="s1">&#39;2c\new line&#39;</span><span class="w"> </span>file.txt
sed<span class="w"> </span><span class="s1">&#39;/pattern/c\new line&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="p">
<h3>打印（p命令）<a class="headerlink" href="#p" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 打印特定行（-n静默模式）</span>
sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;3p&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 第3行</span>
sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;2,5p&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 2-5行</span>
sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/pattern/p&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 匹配行</span>
sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;$p&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 最后一行</span>

<span class="c1"># 打印并删除</span>
sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/pattern/p; /pattern/d&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id7">
<h3>多命令和分支<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># -e 多命令</span>
sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;/pattern/d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># ; 分隔</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/g; /pattern/d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 脚本文件</span>
sed<span class="w"> </span>-f<span class="w"> </span>script.sed<span class="w"> </span>file.txt

<span class="c1"># script.sed 内容：</span>
<span class="c1"># s/old/new/g</span>
<span class="c1"># /pattern/d</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3>实战案例<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 配置文件修改</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/^#Port 22/Port 2222/&#39;</span><span class="w"> </span>/etc/ssh/sshd_config

<span class="c1"># 添加配置</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/\[mysqld\]/a\max_connections=1000&#39;</span><span class="w"> </span>/etc/my.cnf

<span class="c1"># 替换变量</span>
sed<span class="w"> </span><span class="s2">&quot;s/@@VERSION@@/</span><span class="nv">$VERSION</span><span class="s2">/g&quot;</span><span class="w"> </span>template.txt<span class="w"> </span>&gt;<span class="w"> </span>output.txt

<span class="c1"># 删除行尾空格</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/[[:space:]]*$//&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 删除Windows换行符</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/\r$//&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 在每行前加行号</span>
<span class="nv">sed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;N;s/\n/\t/&#39;</span>

<span class="c1"># 大小写转换</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;y/a-z/A-Z/&#39;</span><span class="w">  </span><span class="c1"># HELLO</span>

<span class="c1"># 提取IP地址</span>
ifconfig<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/inet /p&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/.*inet \([0-9.]*\).*/\1/&#39;</span>

<span class="c1"># 批量重命名</span>
<span class="k">for</span><span class="w"> </span>f<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$f</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/\.txt$/.bak/&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># HTML转义</span>
sed<span class="w"> </span><span class="s1">&#39;s/&amp;/\&amp;amp;/g; s/&lt;/\&amp;lt;/g; s/&gt;/\&amp;gt;/g&#39;</span><span class="w"> </span>file.html
</pre></div>
</div>
</section>
<section id="id9">
<h3>sed高级技巧<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 保持空间（h、H、g、G、x）</span>
<span class="c1"># h：复制模式空间到保持空间</span>
<span class="c1"># g：复制保持空间到模式空间</span>
<span class="c1"># x：交换</span>

<span class="c1"># 倒序输出（tac的实现）</span>
sed<span class="w"> </span><span class="s1">&#39;1!G;h;$!d&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 删除重复行（uniq的实现）</span>
sed<span class="w"> </span><span class="s1">&#39;$!N; /^\(.*\)\n\1$/!P; D&#39;</span>

<span class="c1"># 每两行合并</span>
sed<span class="w"> </span><span class="s1">&#39;N;s/\n/ /&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
</section>
<section id="awk">
<h2>awk - 文本分析<a class="headerlink" href="#awk" title="Permalink to this heading"></a></h2>
<p>awk是强大的文本分析工具，支持变量、数组、函数，类似小型编程语言。</p>
<section id="id10">
<h3>基本语法<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>awk<span class="w"> </span><span class="s1">&#39;pattern {action}&#39;</span><span class="w"> </span>file

<span class="c1"># 内置变量</span>
<span class="nv">$0</span><span class="w">      </span><span class="c1"># 整行</span>
<span class="nv">$1</span>-<span class="nv">$NF</span><span class="w">  </span><span class="c1"># 第1到最后一列</span>
NF<span class="w">      </span><span class="c1"># 列数（字段数）</span>
NR<span class="w">      </span><span class="c1"># 行号（总）</span>
FNR<span class="w">     </span><span class="c1"># 行号（当前文件）</span>
FS<span class="w">      </span><span class="c1"># 输入分隔符（默认空格）</span>
OFS<span class="w">     </span><span class="c1"># 输出分隔符（默认空格）</span>
RS<span class="w">      </span><span class="c1"># 行分隔符（默认换行）</span>
ORS<span class="w">     </span><span class="c1"># 输出行分隔符</span>
FILENAME<span class="w"> </span><span class="c1"># 当前文件名</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>基本用法<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 打印整行</span>
awk<span class="w"> </span><span class="s1">&#39;{print}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{print $0}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 打印特定列</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 第1列</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1, $3}&#39;</span><span class="w"> </span>file.txt<span class="w">    </span><span class="c1"># 第1和第3列</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1 &quot;\t&quot; $3}&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 制表符分隔</span>
awk<span class="w"> </span><span class="s1">&#39;{print $NF}&#39;</span><span class="w"> </span>file.txt<span class="w">       </span><span class="c1"># 最后一列</span>
awk<span class="w"> </span><span class="s1">&#39;{print $(NF-1)}&#39;</span><span class="w"> </span>file.txt<span class="w">   </span><span class="c1"># 倒数第2列</span>

<span class="c1"># 打印行号</span>
awk<span class="w"> </span><span class="s1">&#39;{print NR, $0}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 自定义分隔符</span>
awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>/etc/passwd<span class="w">  </span><span class="c1"># 冒号分隔</span>
awk<span class="w"> </span>-F<span class="s1">&#39;[,:]&#39;</span><span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 多个分隔符</span>

<span class="c1"># 输出分隔符</span>
awk<span class="w"> </span><span class="s1">&#39;BEGIN{OFS=&quot;,&quot;} {print $1, $2}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 条件打印</span>
awk<span class="w"> </span><span class="s1">&#39;$3 &gt; 100&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 第3列&gt;100</span>
awk<span class="w"> </span><span class="s1">&#39;/pattern/&#39;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 包含pattern</span>
awk<span class="w"> </span><span class="s1">&#39;!/pattern/&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 不包含</span>
awk<span class="w"> </span><span class="s1">&#39;NR==5&#39;</span><span class="w"> </span>file.txt<span class="w">             </span><span class="c1"># 第5行</span>
awk<span class="w"> </span><span class="s1">&#39;NR&gt;=2 &amp;&amp; NR&lt;=5&#39;</span><span class="w"> </span>file.txt<span class="w">    </span><span class="c1"># 2-5行</span>
</pre></div>
</div>
</section>
<section id="id12">
<h3>模式匹配<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 正则匹配</span>
awk<span class="w"> </span><span class="s1">&#39;/^[0-9]/&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 数字开头</span>
awk<span class="w"> </span><span class="s1">&#39;/error/i&#39;</span><span class="w"> </span>file.txt<span class="w">          </span><span class="c1"># 忽略大小写</span>
awk<span class="w"> </span><span class="s1">&#39;$1 ~ /^a/&#39;</span><span class="w"> </span>file.txt<span class="w">         </span><span class="c1"># 第1列以a开头</span>
awk<span class="w"> </span><span class="s1">&#39;$1 !~ /^a/&#39;</span><span class="w"> </span>file.txt<span class="w">        </span><span class="c1"># 第1列不以a开头</span>

<span class="c1"># 范围匹配</span>
awk<span class="w"> </span><span class="s1">&#39;/start/,/end/&#39;</span><span class="w"> </span>file.txt<span class="w">     </span><span class="c1"># start到end之间</span>

<span class="c1"># 逻辑运算</span>
awk<span class="w"> </span><span class="s1">&#39;$1 == &quot;root&quot;&#39;</span><span class="w"> </span>/etc/passwd
awk<span class="w"> </span><span class="s1">&#39;$3 &gt; 100 &amp;&amp; $4 &lt; 200&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;$1 == &quot;Alice&quot; || $1 == &quot;Bob&quot;&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="beginend">
<h3>BEGIN和END<a class="headerlink" href="#beginend" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># BEGIN：处理前执行</span>
awk<span class="w"> </span><span class="s1">&#39;BEGIN {print &quot;Name\tAge&quot;} {print}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># END：处理后执行</span>
awk<span class="w"> </span><span class="s1">&#39;{sum += $1} END {print &quot;Total:&quot;, sum}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 组合使用</span>
awk<span class="w"> </span><span class="s1">&#39;BEGIN {print &quot;Start&quot;} {print} END {print &quot;End&quot;}&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id13">
<h3>运算和变量<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 算术运算</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1 + $2}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{print $1 * 2}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{sum += $1} END {print sum}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 变量</span>
awk<span class="w"> </span><span class="s1">&#39;{count++} END {print count}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;BEGIN {total=0} {total += $1} END {print total/NR}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 数组</span>
awk<span class="w"> </span><span class="s1">&#39;{arr[$1]++} END {for (i in arr) print i, arr[i]}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 统计</span>
awk<span class="w"> </span><span class="s1">&#39;{sum += $1; sumsq += $1*$1}</span>
<span class="s1">     END {print &quot;Avg:&quot;, sum/NR, &quot;StdDev:&quot;, sqrt(sumsq/NR - (sum/NR)^2)}&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id14">
<h3>格式化输出<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># printf</span>
awk<span class="w"> </span><span class="s1">&#39;{printf &quot;%s\t%d\n&quot;, $1, $2}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{printf &quot;%-10s %5d\n&quot;, $1, $2}&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 左对齐、右对齐</span>
awk<span class="w"> </span><span class="s1">&#39;{printf &quot;%.2f\n&quot;, $1}&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 保留2位小数</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3>条件和循环<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># if语句</span>
awk<span class="w"> </span><span class="s1">&#39;{if ($3 &gt; 100) print $1}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{if ($1 == &quot;Alice&quot;) print $0; else print &quot;Not Alice&quot;}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># for循环</span>
awk<span class="w"> </span><span class="s1">&#39;{for (i=1; i&lt;=NF; i++) print $i}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># while循环</span>
awk<span class="w"> </span><span class="s1">&#39;{i=1; while (i&lt;=NF) {print $i; i++}}&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id16">
<h3>函数<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 字符串函数</span>
length<span class="o">(</span><span class="nv">$1</span><span class="o">)</span><span class="w">           </span><span class="c1"># 长度</span>
substr<span class="o">(</span><span class="nv">$1</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span><span class="w">     </span><span class="c1"># 截取（从1开始，长度3）</span>
index<span class="o">(</span><span class="nv">$1</span>,<span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="o">)</span><span class="w">       </span><span class="c1"># 查找位置</span>
split<span class="o">(</span><span class="nv">$0</span>,<span class="w"> </span>arr,<span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="o">)</span><span class="w">  </span><span class="c1"># 分割</span>
sub<span class="o">(</span>/old/,<span class="w"> </span><span class="s2">&quot;new&quot;</span><span class="o">)</span><span class="w">    </span><span class="c1"># 替换第一个</span>
gsub<span class="o">(</span>/old/,<span class="w"> </span><span class="s2">&quot;new&quot;</span><span class="o">)</span><span class="w">   </span><span class="c1"># 替换所有</span>
tolower<span class="o">(</span><span class="nv">$1</span><span class="o">)</span><span class="w">          </span><span class="c1"># 转小写</span>
toupper<span class="o">(</span><span class="nv">$1</span><span class="o">)</span><span class="w">          </span><span class="c1"># 转大写</span>

<span class="c1"># 数学函数</span>
int<span class="o">(</span><span class="nv">$1</span><span class="o">)</span><span class="w">              </span><span class="c1"># 取整</span>
sqrt<span class="o">(</span><span class="nv">$1</span><span class="o">)</span><span class="w">             </span><span class="c1"># 平方根</span>
rand<span class="o">()</span><span class="w">               </span><span class="c1"># 随机数[0,1)</span>
srand<span class="o">()</span><span class="w">              </span><span class="c1"># 设置随机种子</span>

<span class="c1"># 示例</span>
awk<span class="w"> </span><span class="s1">&#39;{print tolower($1)}&#39;</span><span class="w"> </span>file.txt
awk<span class="w"> </span><span class="s1">&#39;{print length($1)}&#39;</span><span class="w"> </span>file.txt
</pre></div>
</div>
</section>
<section id="id17">
<h3>实战案例<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 统计文件大小</span>
ls<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{sum += $5} END {print &quot;Total:&quot;, sum/1024/1024, &quot;MB&quot;}&#39;</span>

<span class="c1"># 统计日志</span>
awk<span class="w"> </span><span class="s1">&#39;{status[$9]++} END {for (s in status) print s, status[s]}&#39;</span><span class="w"> </span>access.log

<span class="c1"># 提取第N列</span>
awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>/etc/passwd

<span class="c1"># 去重统计</span>
awk<span class="w"> </span><span class="s1">&#39;{arr[$1]++} END {for (i in arr) print i, arr[i]}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 计算平均值</span>
awk<span class="w"> </span><span class="s1">&#39;{sum += $1} END {print sum/NR}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># Top N</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10

<span class="c1"># 合并列</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1 $2 $3}&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 条件求和</span>
awk<span class="w"> </span><span class="s1">&#39;$2 == &quot;error&quot; {count++; sum += $3} END {print count, sum}&#39;</span><span class="w"> </span>log.txt

<span class="c1"># 多文件处理</span>
awk<span class="w"> </span><span class="s1">&#39;{print FILENAME, $0}&#39;</span><span class="w"> </span>file1.txt<span class="w"> </span>file2.txt

<span class="c1"># 处理CSV</span>
awk<span class="w"> </span>-F,<span class="w"> </span><span class="s1">&#39;{print $1, $3}&#39;</span><span class="w"> </span>data.csv

<span class="c1"># JSON提取（简单）</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:25}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="s1">&#39;{print $4}&#39;</span>

<span class="c1"># 生成SQL</span>
awk<span class="w"> </span><span class="s1">&#39;{printf &quot;INSERT INTO users VALUES (\&quot;%s\&quot;, %d);\n&quot;, $1, $2}&#39;</span><span class="w"> </span>data.txt

<span class="c1"># 日志分析：统计状态码</span>
awk<span class="w"> </span><span class="s1">&#39;{print $9}&#39;</span><span class="w"> </span>access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn

<span class="c1"># 计算第95百分位</span>
awk<span class="w"> </span><span class="s1">&#39;{arr[NR]=$1} END {</span>
<span class="s1">    asort(arr);</span>
<span class="s1">    idx = int(NR * 0.95);</span>
<span class="s1">    print &quot;P95:&quot;, arr[idx]</span>
<span class="s1">}&#39;</span><span class="w"> </span>data.txt

<span class="c1"># 过滤时间范围</span>
awk<span class="w"> </span><span class="s1">&#39;$1 &gt;= &quot;2023-01-01&quot; &amp;&amp; $1 &lt;= &quot;2023-12-31&quot;&#39;</span><span class="w"> </span>log.txt

<span class="c1"># 格式化表格</span>
awk<span class="w"> </span><span class="s1">&#39;BEGIN {printf &quot;%-10s %-10s %10s\n&quot;, &quot;Name&quot;, &quot;Age&quot;, &quot;Score&quot;}</span>
<span class="s1">     {printf &quot;%-10s %-10d %10.2f\n&quot;, $1, $2, $3}&#39;</span><span class="w"> </span>data.txt
</pre></div>
</div>
</section>
<section id="id18">
<h3>awk脚本文件<a class="headerlink" href="#id18" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># script.awk</span>
BEGIN<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">FS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;,&quot;</span>
<span class="w">    </span><span class="nv">OFS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;\t&quot;</span>
<span class="w">    </span>print<span class="w"> </span><span class="s2">&quot;Name\tScore&quot;</span>
<span class="o">}</span>

<span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$2</span><span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>pass++
<span class="w">        </span><span class="nv">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$2</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

END<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>print<span class="w"> </span><span class="s2">&quot;Pass:&quot;</span>,<span class="w"> </span>pass
<span class="w">    </span>print<span class="w"> </span><span class="s2">&quot;Average:&quot;</span>,<span class="w"> </span>total/pass
<span class="o">}</span>

<span class="c1"># 执行</span>
awk<span class="w"> </span>-f<span class="w"> </span>script.awk<span class="w"> </span>data.csv
</pre></div>
</div>
</section>
</section>
<section id="id19">
<h2>三剑客组合使用<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h2>
<section id="id20">
<h3>管道组合<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 统计错误日志</span>
grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>app.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c

<span class="c1"># 提取IP并统计</span>
grep<span class="w"> </span><span class="s2">&quot;Failed password&quot;</span><span class="w"> </span>/var/log/auth.log<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>awk<span class="w"> </span><span class="s1">&#39;{print $11}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn

<span class="c1"># 日志分析</span>
cat<span class="w"> </span>access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>grep<span class="w"> </span><span class="s2">&quot;404&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>awk<span class="w"> </span><span class="s1">&#39;{print $7}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>head<span class="w"> </span>-10

<span class="c1"># 替换后过滤</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;new&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span>

<span class="c1"># 多步处理</span>
cat<span class="w"> </span>data.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^#&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\ </span><span class="w">          </span><span class="c1"># 删除注释</span>
<span class="w">    </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\ </span><span class="w">          </span><span class="c1"># 删除空行</span>
<span class="w">    </span>sed<span class="w"> </span><span class="s1">&#39;s/  */ /g&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\ </span><span class="w">       </span><span class="c1"># 多空格转单空格</span>
<span class="w">    </span>awk<span class="w"> </span><span class="s1">&#39;{print $1, $3}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\ </span><span class="w">  </span><span class="c1"># 提取列</span>
<span class="w">    </span>sort<span class="w"> </span>-k2<span class="w"> </span>-n<span class="w">                </span><span class="c1"># 按第2列排序</span>
</pre></div>
</div>
</section>
<section id="id21">
<h3>实战脚本<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># 分析Nginx访问日志</span>

<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/nginx/access.log&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Top 10 IP ===&quot;</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="nv">$LOG_FILE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Top 10 URL ===&quot;</span>
awk<span class="w"> </span><span class="s1">&#39;{print $7}&#39;</span><span class="w"> </span><span class="nv">$LOG_FILE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Status Code Statistics ===&quot;</span>
awk<span class="w"> </span><span class="s1">&#39;{print $9}&#39;</span><span class="w"> </span><span class="nv">$LOG_FILE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== 4xx and 5xx Errors ===&quot;</span>
awk<span class="w"> </span><span class="s1">&#39;$9 ~ /^[45]/ {print $0}&#39;</span><span class="w"> </span><span class="nv">$LOG_FILE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Traffic by Hour ===&quot;</span>
awk<span class="w"> </span><span class="s1">&#39;{print substr($4, 14, 2)}&#39;</span><span class="w"> </span><span class="nv">$LOG_FILE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c
</pre></div>
</div>
</section>
</section>
<section id="id22">
<h2>性能对比<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>任务</p></th>
<th class="head"><p>grep</p></th>
<th class="head"><p>sed</p></th>
<th class="head"><p>awk</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>简单搜索</p></td>
<td><p>⭐⭐⭐</p></td>
<td><p>⭐</p></td>
<td><p>⭐</p></td>
<td><p>grep最快</p></td>
</tr>
<tr class="row-odd"><td><p>替换</p></td>
<td><p>✗</p></td>
<td><p>⭐⭐⭐</p></td>
<td><p>⭐⭐</p></td>
<td><p>sed专用</p></td>
</tr>
<tr class="row-even"><td><p>列提取</p></td>
<td><p>✗</p></td>
<td><p>⭐</p></td>
<td><p>⭐⭐⭐</p></td>
<td><p>awk最强</p></td>
</tr>
<tr class="row-odd"><td><p>统计计算</p></td>
<td><p>✗</p></td>
<td><p>✗</p></td>
<td><p>⭐⭐⭐</p></td>
<td><p>awk专用</p></td>
</tr>
<tr class="row-even"><td><p>复杂逻辑</p></td>
<td><p>✗</p></td>
<td><p>⭐</p></td>
<td><p>⭐⭐⭐</p></td>
<td><p>awk最灵活</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id23">
<h2>最佳实践<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h2>
<section id="id24">
<h3>选择工具<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 仅搜索：grep</span>
grep<span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="w"> </span>app.log

<span class="c1"># 简单替换：sed</span>
sed<span class="w"> </span><span class="s1">&#39;s/old/new/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># 列处理/统计：awk</span>
awk<span class="w"> </span><span class="s1">&#39;{sum += $3} END {print sum}&#39;</span><span class="w"> </span>data.txt

<span class="c1"># 复杂处理：awk脚本</span>
awk<span class="w"> </span>-f<span class="w"> </span>complex.awk<span class="w"> </span>data.txt
</pre></div>
</div>
</section>
<section id="id25">
<h3>性能优化<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># grep: 使用固定字符串（-F）</span>
grep<span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;literal string&quot;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 比正则快</span>

<span class="c1"># sed: 减少正则复杂度</span>
sed<span class="w"> </span><span class="s1">&#39;s/[0-9]\+/NUM/g&#39;</span><span class="w">  </span><span class="c1"># 比 &#39;s/[0-9][0-9]*/NUM/g&#39; 快</span>

<span class="c1"># awk: 提前退出</span>
awk<span class="w"> </span><span class="s1">&#39;{if (NR &gt; 1000) exit} {print}&#39;</span><span class="w"> </span>huge.txt

<span class="c1"># 避免不必要的管道</span>
awk<span class="w"> </span><span class="s1">&#39;/pattern/ {print $1}&#39;</span><span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># 优于 grep pattern | awk &#39;{print $1}&#39;</span>
</pre></div>
</div>
</section>
<section id="id26">
<h3>可读性<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 复杂命令分行</span>
grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>app.log<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>awk<span class="w"> </span><span class="s1">&#39;{print $1, $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>uniq<span class="w"> </span>-c

<span class="c1"># 注释</span>
awk<span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">    # 统计每个状态码的出现次数</span>
<span class="s1">    {status[$9]++}</span>
<span class="s1">    </span>
<span class="s1">    # 输出统计结果</span>
<span class="s1">    END {for (s in status) print s, status[s]}</span>
<span class="s1">&#39;</span><span class="w"> </span>access.log
</pre></div>
</div>
<p><strong>核心：</strong> grep查、sed改、awk析，熟练掌握三剑客是Linux运维的必备技能。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01-basics.html" class="btn btn-neutral float-left" title="01-Shell基础" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03-scripts.html" class="btn btn-neutral float-right" title="03-Shell实用脚本" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Code Dojo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>