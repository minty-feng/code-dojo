

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¿›ç¨‹è°ƒåº¦ &mdash; OS &amp; Network Core 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2d0851c8" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/copy-code.js?v=caf91246"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="å†…å­˜ç®¡ç†" href="../03-memory-management/index.html" />
    <link rel="prev" title="è¿›ç¨‹è°ƒåº¦" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            OS & Network Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ç›®å½•</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">OS &amp; Network Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-process-thread/index.html">è¿›ç¨‹ä¸çº¿ç¨‹</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">è¿›ç¨‹è°ƒåº¦</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">è¿›ç¨‹è°ƒåº¦</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">ğŸ’¡ æ ¸å¿ƒç»“è®º</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">1. è°ƒåº¦ç®—æ³•åˆ†ç±»</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">1.1 éæŠ¢å å¼è°ƒåº¦</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">1.2 æŠ¢å å¼è°ƒåº¦</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">2. ç»å…¸è°ƒåº¦ç®—æ³•</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fcfs">2.1 å…ˆæ¥å…ˆæœåŠ¡ (FCFS)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sjf">2.2 çŸ­ä½œä¸šä¼˜å…ˆ (SJF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#srtf">2.3 æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ (SRTF)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#round-robin">2.4 æ—¶é—´ç‰‡è½®è½¬ (Round Robin)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">2.5 ä¼˜å…ˆçº§è°ƒåº¦</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mlfq">2.6 å¤šçº§åé¦ˆé˜Ÿåˆ— (MLFQ)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linux">3. Linuxè°ƒåº¦å™¨</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cfs">3.1 å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ (CFS)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">3.2 å®æ—¶è°ƒåº¦</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">3.3 Linuxè°ƒåº¦ç±»</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">4. å¤šæ ¸è°ƒåº¦</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">4.1 è´Ÿè½½å‡è¡¡</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu">4.2 CPUäº²å’Œæ€§</a></li>
<li class="toctree-l4"><a class="reference internal" href="#numa">4.3 NUMAæ„ŸçŸ¥è°ƒåº¦</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">5. è°ƒåº¦æ€§èƒ½æŒ‡æ ‡</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#throughput">5.1 ååé‡ (Throughput)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#turnaround-time">5.2 å‘¨è½¬æ—¶é—´ (Turnaround Time)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#waiting-time">5.3 ç­‰å¾…æ—¶é—´ (Waiting Time)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#response-time">5.4 å“åº”æ—¶é—´ (Response Time)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">5.5 CPUåˆ©ç”¨ç‡</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id14">6. å®æˆ˜æ¡ˆä¾‹</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">6.1 è°ƒåº¦ç®—æ³•å¯¹æ¯”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">6.2 ä¼˜å…ˆçº§åè½¬é—®é¢˜</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">6.3 CPUæ—¶é—´æµ‹é‡</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id18">7. è°ƒåº¦å™¨è°ƒä¼˜</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nice">7.1 ä¿®æ”¹niceå€¼</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">7.2 è®¾ç½®å®æ—¶ä¼˜å…ˆçº§</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">7.3 CFSè°ƒä¼˜å‚æ•°</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id21">8. å¸¸è§é—®é¢˜</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#q1-linuxcfs">Q1: ä¸ºä»€ä¹ˆLinuxç”¨CFSè€Œä¸æ˜¯ä¼ ç»Ÿä¼˜å…ˆçº§è°ƒåº¦ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q2">Q2: å®æ—¶è°ƒåº¦ä¼šå¯¼è‡´ç³»ç»Ÿå¡æ­»å—ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q3">Q3: å¦‚ä½•é€‰æ‹©æ—¶é—´ç‰‡å¤§å°ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q4">Q4: å¤šæ ¸è°ƒåº¦å¦‚ä½•é¿å…ç¼“å­˜é¢ ç°¸ï¼Ÿ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id22">å‚è€ƒèµ„æº</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../03-memory-management/index.html">å†…å­˜ç®¡ç†</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-file-system/index.html">æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-concurrency-sync/index.html">å¹¶å‘ä¸åŒæ­¥</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-deadlock/index.html">æ­»é”å¤„ç†</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-tcp-ip/index.html">TCP-IPåè®®è¯¦è§£</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-http/index.html">HTTPåè®®ä¸å®æˆ˜</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09-socket/index.html">Socketç¼–ç¨‹å®æˆ˜</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10-network-tools/index.html">ç½‘ç»œå·¥å…·å¤§å…¨</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11-network-security/index.html">ç½‘ç»œå®‰å…¨åŸºç¡€</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OS & Network Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">è¿›ç¨‹è°ƒåº¦</a></li>
      <li class="breadcrumb-item active">è¿›ç¨‹è°ƒåº¦</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/02-process-scheduling/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>è¿›ç¨‹è°ƒåº¦<a class="headerlink" href="#id1" title="Permalink to this heading">ïƒ</a></h1>
<section id="id2">
<h2>ğŸ’¡ æ ¸å¿ƒç»“è®º<a class="headerlink" href="#id2" title="Permalink to this heading">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>CPUå¯†é›†å‹ä»»åŠ¡é€‚åˆçŸ­ä½œä¸šä¼˜å…ˆï¼ŒI/Oå¯†é›†å‹é€‚åˆæ—¶é—´ç‰‡è½®è½¬</strong></p></li>
<li><p><strong>ä¼˜å…ˆçº§è°ƒåº¦å®¹æ˜“å¯¼è‡´é¥¥é¥¿ï¼Œéœ€è¦è€åŒ–(aging)æœºåˆ¶</strong></p></li>
<li><p><strong>Linux CFSè°ƒåº¦å™¨è¿½æ±‚å®Œå…¨å…¬å¹³ï¼Œä½¿ç”¨çº¢é»‘æ ‘ç®¡ç†è¿›ç¨‹</strong></p></li>
<li><p><strong>å®æ—¶è°ƒåº¦ä¼˜å…ˆçº§é«˜äºæ™®é€šè°ƒåº¦ï¼Œä¿è¯å“åº”æ—¶é—´</strong></p></li>
<li><p><strong>å¤šæ ¸è°ƒåº¦éœ€è¦è´Ÿè½½å‡è¡¡ï¼Œé¿å…æŸäº›æ ¸å¿ƒè¿‡è½½</strong></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="id3">
<h2>1. è°ƒåº¦ç®—æ³•åˆ†ç±»<a class="headerlink" href="#id3" title="Permalink to this heading">ïƒ</a></h2>
<section id="id4">
<h3>1.1 éæŠ¢å å¼è°ƒåº¦<a class="headerlink" href="#id4" title="Permalink to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>è¿›ç¨‹ä¸»åŠ¨æ”¾å¼ƒCPUæ‰èƒ½è°ƒåº¦</p></li>
<li><p>ç®€å•ï¼Œæ— éœ€å¤„ç†ç«æ€æ¡ä»¶</p></li>
<li><p>å“åº”æ—¶é—´å·®</p></li>
</ul>
</section>
<section id="id5">
<h3>1.2 æŠ¢å å¼è°ƒåº¦<a class="headerlink" href="#id5" title="Permalink to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>å¯ä»¥å¼ºåˆ¶å‰¥å¤ºCPU</p></li>
<li><p>å“åº”æ—¶é—´å¥½</p></li>
<li><p>éœ€è¦å¤„ç†åŒæ­¥é—®é¢˜</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id6">
<h2>2. ç»å…¸è°ƒåº¦ç®—æ³•<a class="headerlink" href="#id6" title="Permalink to this heading">ïƒ</a></h2>
<section id="fcfs">
<h3>2.1 å…ˆæ¥å…ˆæœåŠ¡ (FCFS)<a class="headerlink" href="#fcfs" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæŒ‰åˆ°è¾¾é¡ºåºæ‰§è¡Œï¼ŒéæŠ¢å å¼</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">fcfs_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">queue_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w">  </span><span class="c1">// è¿è¡Œç›´åˆ°ç»“æŸ</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>æœ€ç®€å•</p></li>
<li><p>å¹³å‡ç­‰å¾…æ—¶é—´é•¿</p></li>
<li><p>æŠ¤èˆªæ•ˆåº”ï¼ˆConvoy Effectï¼‰ï¼šé•¿è¿›ç¨‹é˜»å¡çŸ­è¿›ç¨‹</p></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>è¿›ç¨‹  åˆ°è¾¾  è¿è¡Œ
P1    0    10
P2    1     1
P3    2     1

æ‰§è¡Œé¡ºåºï¼šP1(10) â†’ P2(1) â†’ P3(1)
ç­‰å¾…æ—¶é—´ï¼šP1=0, P2=9, P3=10
å¹³å‡ç­‰å¾…ï¼š6.33
</pre></div>
</div>
</section>
<section id="sjf">
<h3>2.2 çŸ­ä½œä¸šä¼˜å…ˆ (SJF)<a class="headerlink" href="#sjf" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šé€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">sjf_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æŒ‰è¿è¡Œæ—¶é—´æ’åº</span>
<span class="w">    </span><span class="n">sort_by_burst_time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">queue_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>å¹³å‡ç­‰å¾…æ—¶é—´æœ€ä¼˜ï¼ˆç†è®ºä¸Šï¼‰</p></li>
<li><p>éœ€è¦é¢„çŸ¥è¿è¡Œæ—¶é—´ï¼ˆå®é™…ä¸å¯èƒ½ï¼‰</p></li>
<li><p>é•¿è¿›ç¨‹å¯èƒ½é¥¥é¥¿</p></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>è¿›ç¨‹  åˆ°è¾¾  è¿è¡Œ
P1    0    10
P2    1     1
P3    2     1

æ‰§è¡Œé¡ºåºï¼šP2(1) â†’ P3(1) â†’ P1(10)
ç­‰å¾…æ—¶é—´ï¼šP1=2, P2=0, P3=0
å¹³å‡ç­‰å¾…ï¼š0.67
</pre></div>
</div>
</section>
<section id="srtf">
<h3>2.3 æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ (SRTF)<a class="headerlink" href="#srtf" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>SJFçš„æŠ¢å å¼ç‰ˆæœ¬</strong>ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">srtf_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">has_process</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æ–°è¿›ç¨‹åˆ°è¾¾æ—¶æ£€æŸ¥</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_process_arrival</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_new_process</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">new</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">preempt</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
<span class="w">                </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">run_one_tick</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
<span class="w">        </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>å¹³å‡ç­‰å¾…æ—¶é—´æœ€ä¼˜ï¼ˆæŠ¢å å¼ï¼‰</p></li>
<li><p>é¢‘ç¹åˆ‡æ¢ï¼Œå¼€é”€å¤§</p></li>
<li><p>é•¿è¿›ç¨‹é¥¥é¥¿æ›´ä¸¥é‡</p></li>
</ul>
</section>
<section id="round-robin">
<h3>2.4 æ—¶é—´ç‰‡è½®è½¬ (Round Robin)<a class="headerlink" href="#round-robin" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæ¯ä¸ªè¿›ç¨‹æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç„¶ååˆ‡æ¢</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define TIME_SLICE 10  </span><span class="c1">// æ—¶é—´ç‰‡å¤§å°ï¼ˆmsï¼‰</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">round_robin_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">queue_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">);</span>
<span class="w">        </span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="p">,</span><span class="w"> </span><span class="n">TIME_SLICE</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_for</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="p">);</span>
<span class="w">        </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">runtime</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">queue_enqueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ”¾å›é˜Ÿå°¾</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>æ—¶é—´ç‰‡é€‰æ‹©</strong>ï¼š</p>
<ul class="simple">
<li><p>å¤ªå°ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§</p></li>
<li><p>å¤ªå¤§ï¼šé€€åŒ–ä¸ºFCFS</p></li>
<li><p>ç»éªŒå€¼ï¼š10-100ms</p></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼ˆæ—¶é—´ç‰‡=4ï¼‰ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>è¿›ç¨‹  è¿è¡Œæ—¶é—´
P1    10
P2     5
P3     3

æ‰§è¡Œï¼šP1(4) â†’ P2(4) â†’ P3(3) â†’ P1(4) â†’ P2(1) â†’ P1(2)
</pre></div>
</div>
</section>
<section id="id7">
<h3>2.5 ä¼˜å…ˆçº§è°ƒåº¦<a class="headerlink" href="#id7" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å…ˆæ‰§è¡Œ</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">remaining</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">priority_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_highest_priority</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ready_queue</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>é—®é¢˜ï¼šé¥¥é¥¿</strong></p>
<ul class="simple">
<li><p>ä½ä¼˜å…ˆçº§è¿›ç¨‹å¯èƒ½æ°¸è¿œå¾—ä¸åˆ°æ‰§è¡Œ</p></li>
</ul>
<p><strong>è§£å†³ï¼šè€åŒ– (Aging)</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// ç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">aging</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ready_queue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">priority</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">wait_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">  </span><span class="c1">// åŠ¨æ€æå‡ä¼˜å…ˆçº§</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mlfq">
<h3>2.6 å¤šçº§åé¦ˆé˜Ÿåˆ— (MLFQ)<a class="headerlink" href="#mlfq" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šå¤šä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒåŠ¨æ€è°ƒæ•´ä¼˜å…ˆçº§</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define LEVELS 3</span>
<span class="n">Queue</span><span class="w"> </span><span class="n">queues</span><span class="p">[</span><span class="n">LEVELS</span><span class="p">];</span><span class="w">  </span><span class="c1">// ä¼˜å…ˆçº§ä»0åˆ°2é€’å‡</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">mlfq_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è§„åˆ™1ï¼šä¼˜å…ˆçº§é«˜çš„å…ˆæ‰§è¡Œ</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LEVELS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queues</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queues</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">            </span>
<span class="w">            </span><span class="n">run_for</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">time_slice</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">            </span>
<span class="w">            </span><span class="c1">// è§„åˆ™2ï¼šç”¨å®Œæ—¶é—´ç‰‡ï¼Œé™çº§</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LEVELS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w">  </span><span class="c1">// é™çº§</span>
<span class="w">                </span><span class="n">enqueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// è§„åˆ™3ï¼šå®šæœŸæå‡æ‰€æœ‰è¿›ç¨‹åˆ°æœ€é«˜ä¼˜å…ˆçº§ï¼ˆé˜²æ­¢é¥¥é¥¿ï¼‰</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">timer</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">BOOST_INTERVAL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">boost_all_to_top</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>MLFQè§„åˆ™</strong>ï¼š</p>
<ol class="arabic simple">
<li><p>ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—å…ˆæ‰§è¡Œ</p></li>
<li><p>æ–°è¿›ç¨‹è¿›å…¥æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—</p></li>
<li><p>è¿›ç¨‹ç”¨å®Œæ—¶é—´ç‰‡ï¼Œé™åˆ°ä¸‹ä¸€çº§é˜Ÿåˆ—</p></li>
<li><p>I/Oé˜»å¡åè¿”å›ï¼Œä¿æŒå½“å‰ä¼˜å…ˆçº§</p></li>
<li><p>å®šæœŸæå‡æ‰€æœ‰è¿›ç¨‹ï¼ˆé˜²æ­¢é¥¥é¥¿ï¼‰</p></li>
</ol>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>è‡ªåŠ¨åŒºåˆ†I/Oå¯†é›†å’ŒCPUå¯†é›†</p></li>
<li><p>CPUå¯†é›†å‹ä¼šé€æ¸é™çº§</p></li>
<li><p>I/Oå¯†é›†å‹ä¿æŒé«˜ä¼˜å…ˆçº§</p></li>
<li><p>å“åº”æ—¶é—´å¥½</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="linux">
<h2>3. Linuxè°ƒåº¦å™¨<a class="headerlink" href="#linux" title="Permalink to this heading">ïƒ</a></h2>
<section id="cfs">
<h3>3.1 å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ (CFS)<a class="headerlink" href="#cfs" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè®©æ¯ä¸ªè¿›ç¨‹è·å¾—ç›¸åŒçš„CPUæ—¶é—´</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">sched_entity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">vruntime</span><span class="p">;</span><span class="w">         </span><span class="c1">// è™šæ‹Ÿè¿è¡Œæ—¶é—´</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">sum_exec_runtime</span><span class="p">;</span><span class="w"> </span><span class="c1">// å®é™…è¿è¡Œæ—¶é—´</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w">           </span><span class="c1">// æƒé‡ï¼ˆç”±niceå€¼å†³å®šï¼‰</span>
<span class="p">};</span>

<span class="c1">// è™šæ‹Ÿè¿è¡Œæ—¶é—´è®¡ç®—</span>
<span class="n">vruntime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">delta_exec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NICE_0_LOAD</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>CFSæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">cfs_rq</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">rb_root</span><span class="w"> </span><span class="n">tasks_timeline</span><span class="p">;</span><span class="w">  </span><span class="c1">// çº¢é»‘æ ‘æ ¹</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">rb_node</span><span class="w"> </span><span class="o">*</span><span class="n">rb_leftmost</span><span class="p">;</span><span class="w">    </span><span class="c1">// æœ€å·¦èŠ‚ç‚¹ï¼ˆvruntimeæœ€å°ï¼‰</span>
<span class="p">};</span>

<span class="c1">// é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼šO(1)</span>
<span class="n">Process</span><span class="o">*</span><span class="w"> </span><span class="nf">pick_next_task_fair</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rb_entry</span><span class="p">(</span><span class="n">cfs_rq</span><span class="o">-&gt;</span><span class="n">rb_leftmost</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sched_entity</span><span class="p">,</span><span class="w"> </span><span class="n">run_node</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æ’å…¥è¿›ç¨‹ï¼šO(log n)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">enqueue_task_fair</span><span class="p">(</span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rb_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfs_rq</span><span class="o">-&gt;</span><span class="n">tasks_timeline</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>niceå€¼ä¸æƒé‡</strong>ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// niceå€¼èŒƒå›´ï¼š-20åˆ°19</span>
<span class="c1">// niceå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæƒé‡è¶Šå¤§</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">prio_to_weight</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* -20 */</span><span class="w"> </span><span class="mi">88761</span><span class="p">,</span><span class="w"> </span><span class="mi">71755</span><span class="p">,</span><span class="w"> </span><span class="mi">56483</span><span class="p">,</span><span class="w"> </span><span class="mi">46273</span><span class="p">,</span><span class="w"> </span><span class="mi">36291</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/* -15 */</span><span class="w"> </span><span class="mi">29154</span><span class="p">,</span><span class="w"> </span><span class="mi">23254</span><span class="p">,</span><span class="w"> </span><span class="mi">18705</span><span class="p">,</span><span class="w"> </span><span class="mi">14949</span><span class="p">,</span><span class="w"> </span><span class="mi">11916</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/* -10 */</span><span class="w"> </span><span class="mi">9548</span><span class="p">,</span><span class="w">  </span><span class="mi">7620</span><span class="p">,</span><span class="w">  </span><span class="mi">6100</span><span class="p">,</span><span class="w">  </span><span class="mi">4904</span><span class="p">,</span><span class="w">  </span><span class="mi">3906</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/*  -5 */</span><span class="w"> </span><span class="mi">3121</span><span class="p">,</span><span class="w">  </span><span class="mi">2501</span><span class="p">,</span><span class="w">  </span><span class="mi">1991</span><span class="p">,</span><span class="w">  </span><span class="mi">1586</span><span class="p">,</span><span class="w">  </span><span class="mi">1277</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/*   0 */</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w">  </span><span class="mi">820</span><span class="p">,</span><span class="w">   </span><span class="mi">655</span><span class="p">,</span><span class="w">   </span><span class="mi">526</span><span class="p">,</span><span class="w">   </span><span class="mi">423</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/*   5 */</span><span class="w"> </span><span class="mi">335</span><span class="p">,</span><span class="w">   </span><span class="mi">272</span><span class="p">,</span><span class="w">   </span><span class="mi">215</span><span class="p">,</span><span class="w">   </span><span class="mi">172</span><span class="p">,</span><span class="w">   </span><span class="mi">137</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/*  10 */</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w">   </span><span class="mi">87</span><span class="p">,</span><span class="w">    </span><span class="mi">70</span><span class="p">,</span><span class="w">    </span><span class="mi">56</span><span class="p">,</span><span class="w">    </span><span class="mi">45</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/*  15 */</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w">    </span><span class="mi">29</span><span class="p">,</span><span class="w">    </span><span class="mi">23</span><span class="p">,</span><span class="w">    </span><span class="mi">18</span><span class="p">,</span><span class="w">    </span><span class="mi">15</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p><strong>CFSè°ƒåº¦ç¤ºä¾‹</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>è¿›ç¨‹  nice  æƒé‡  å®é™…è¿è¡Œ  vruntime
P1     0    1024    10ms     10ms
P2    -5    3121    10ms     3.3ms
P3     5     335    10ms     30.5ms

ä¸‹æ¬¡è°ƒåº¦ï¼šé€‰æ‹©vruntimeæœ€å°çš„P2
</pre></div>
</div>
</section>
<section id="id8">
<h3>3.2 å®æ—¶è°ƒåº¦<a class="headerlink" href="#id8" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>SCHED_FIFO</strong>ï¼šå…ˆè¿›å…ˆå‡ºï¼ŒéæŠ¢å </p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">sched_fifo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_queue</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_until_block_or_yield</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w">  </span><span class="c1">// è¿è¡Œç›´åˆ°é˜»å¡æˆ–ä¸»åŠ¨è®©å‡º</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>SCHED_RR</strong>ï¼šæ—¶é—´ç‰‡è½®è½¬</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">sched_rr</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_queue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_queue</span><span class="p">);</span>
<span class="w">        </span><span class="n">run_for</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">RT_TIME_SLICE</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">remaining</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">enqueue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rt_queue</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>å®æ—¶ä¼˜å…ˆçº§</strong>ï¼š</p>
<ul class="simple">
<li><p>èŒƒå›´ï¼š1-99ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰</p></li>
<li><p>å®æ—¶è¿›ç¨‹ä¼˜å…ˆäºæ™®é€šè¿›ç¨‹</p></li>
<li><p>ç›¸åŒä¼˜å…ˆçº§æŒ‰FIFOæˆ–RRè°ƒåº¦</p></li>
</ul>
</section>
<section id="id9">
<h3>3.3 Linuxè°ƒåº¦ç±»<a class="headerlink" href="#id9" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. stop_sched_class      // æœ€é«˜ä¼˜å…ˆçº§ï¼ˆè¿ç§»çº¿ç¨‹ï¼‰
2. dl_sched_class        // æˆªæ­¢æ—¶é—´è°ƒåº¦ï¼ˆSCHED_DEADLINEï¼‰
3. rt_sched_class        // å®æ—¶è°ƒåº¦ï¼ˆSCHED_FIFO/RRï¼‰
4. fair_sched_class      // å…¬å¹³è°ƒåº¦ï¼ˆSCHED_NORMALï¼‰
5. idle_sched_class      // ç©ºé—²è°ƒåº¦
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id10">
<h2>4. å¤šæ ¸è°ƒåº¦<a class="headerlink" href="#id10" title="Permalink to this heading">ïƒ</a></h2>
<section id="id11">
<h3>4.1 è´Ÿè½½å‡è¡¡<a class="headerlink" href="#id11" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>é—®é¢˜</strong>ï¼šæŸäº›æ ¸å¿ƒè´Ÿè½½è¿‡é‡ï¼ŒæŸäº›æ ¸å¿ƒç©ºé—²</p>
<p><strong>è§£å†³</strong>ï¼šå‘¨æœŸæ€§è¿ç§»è¿›ç¨‹</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">load_balance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ¯ä¸ªtickæ£€æŸ¥</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">need_balance</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">busiest_cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_busiest_cpu</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">idle_cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_idle_cpu</span><span class="p">();</span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">busiest_cpu</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">idle_cpu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pull_task</span><span class="p">(</span><span class="n">busiest_cpu</span><span class="p">);</span>
<span class="w">            </span><span class="n">push_task</span><span class="p">(</span><span class="n">idle_cpu</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">need_balance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_load</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_max_cpu_load</span><span class="p">();</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">min_load</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_min_cpu_load</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">max_load</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">min_load</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">THRESHOLD</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="cpu">
<h3>4.2 CPUäº²å’Œæ€§<a class="headerlink" href="#cpu" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// ç»‘å®šè¿›ç¨‹åˆ°ç‰¹å®šCPUé›†åˆ</span>
<span class="kt">cpu_set_t</span><span class="w"> </span><span class="n">cpuset</span><span class="p">;</span>
<span class="n">CPU_ZERO</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cpuset</span><span class="p">);</span>
<span class="n">CPU_SET</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cpuset</span><span class="p">);</span><span class="w">  </span><span class="c1">// åªåœ¨CPU 0ä¸Šè¿è¡Œ</span>
<span class="n">CPU_SET</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cpuset</span><span class="p">);</span><span class="w">  </span><span class="c1">// æˆ–CPU 1</span>
<span class="n">sched_setaffinity</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cpuset</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cpuset</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<ul class="simple">
<li><p>å‡å°‘ç¼“å­˜å¤±æ•ˆ</p></li>
<li><p>æé«˜ç¼“å­˜å‘½ä¸­ç‡</p></li>
<li><p>å‡å°‘è¿›ç¨‹è¿ç§»</p></li>
</ul>
</section>
<section id="numa">
<h3>4.3 NUMAæ„ŸçŸ¥è°ƒåº¦<a class="headerlink" href="#numa" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Non-Uniform Memory Access</span>
<span class="c1">// å†…å­˜è®¿é—®å»¶è¿Ÿä¸åŒ</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">numa_node</span><span class="p">;</span><span class="w">  </span><span class="c1">// é¦–é€‰NUMAèŠ‚ç‚¹</span>
<span class="p">};</span>

<span class="c1">// ä¼˜å…ˆåœ¨æœ¬åœ°NUMAèŠ‚ç‚¹è°ƒåº¦</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">numa_schedule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="o">-&gt;</span><span class="n">numa_node</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_idle_cpu_in_node</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="n">schedule_on_cpu</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">cpu</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id12">
<h2>5. è°ƒåº¦æ€§èƒ½æŒ‡æ ‡<a class="headerlink" href="#id12" title="Permalink to this heading">ïƒ</a></h2>
<section id="throughput">
<h3>5.1 ååé‡ (Throughput)<a class="headerlink" href="#throughput" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ååé‡</span> <span class="o">=</span> <span class="n">å®Œæˆçš„è¿›ç¨‹æ•°</span> <span class="o">/</span> <span class="n">æ—¶é—´</span>
</pre></div>
</div>
</section>
<section id="turnaround-time">
<h3>5.2 å‘¨è½¬æ—¶é—´ (Turnaround Time)<a class="headerlink" href="#turnaround-time" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">å‘¨è½¬æ—¶é—´</span> <span class="o">=</span> <span class="n">å®Œæˆæ—¶é—´</span> <span class="o">-</span> <span class="n">åˆ°è¾¾æ—¶é—´</span>
<span class="n">å¹³å‡å‘¨è½¬æ—¶é—´</span> <span class="o">=</span> <span class="n">Î£å‘¨è½¬æ—¶é—´</span> <span class="o">/</span> <span class="n">è¿›ç¨‹æ•°</span>
</pre></div>
</div>
</section>
<section id="waiting-time">
<h3>5.3 ç­‰å¾…æ—¶é—´ (Waiting Time)<a class="headerlink" href="#waiting-time" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ç­‰å¾…æ—¶é—´</span> <span class="o">=</span> <span class="n">å‘¨è½¬æ—¶é—´</span> <span class="o">-</span> <span class="n">è¿è¡Œæ—¶é—´</span>
</pre></div>
</div>
</section>
<section id="response-time">
<h3>5.4 å“åº”æ—¶é—´ (Response Time)<a class="headerlink" href="#response-time" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">å“åº”æ—¶é—´</span> <span class="o">=</span> <span class="n">é¦–æ¬¡æ‰§è¡Œæ—¶é—´</span> <span class="o">-</span> <span class="n">åˆ°è¾¾æ—¶é—´</span>
</pre></div>
</div>
</section>
<section id="id13">
<h3>5.5 CPUåˆ©ç”¨ç‡<a class="headerlink" href="#id13" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPUåˆ©ç”¨ç‡</span> <span class="o">=</span> <span class="p">(</span><span class="n">æ€»è¿è¡Œæ—¶é—´</span> <span class="o">-</span> <span class="n">ç©ºé—²æ—¶é—´</span><span class="p">)</span> <span class="o">/</span> <span class="n">æ€»è¿è¡Œæ—¶é—´</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id14">
<h2>6. å®æˆ˜æ¡ˆä¾‹<a class="headerlink" href="#id14" title="Permalink to this heading">ïƒ</a></h2>
<section id="id15">
<h3>6.1 è°ƒåº¦ç®—æ³•å¯¹æ¯”<a class="headerlink" href="#id15" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åœºæ™¯</strong>ï¼š3ä¸ªè¿›ç¨‹ï¼Œæ—¶é—´ç‰‡=2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">è¿›ç¨‹</span>  <span class="n">åˆ°è¾¾</span>  <span class="n">è¿è¡Œ</span>
<span class="n">P1</span>    <span class="mi">0</span>     <span class="mi">5</span>
<span class="n">P2</span>    <span class="mi">1</span>     <span class="mi">3</span>
<span class="n">P3</span>    <span class="mi">3</span>     <span class="mi">1</span>
</pre></div>
</div>
<p><strong>FCFS</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>æ—¶é—´çº¿ï¼š|P1(5)|P2(3)|P3(1)|
ç­‰å¾…ï¼šP1=0, P2=4, P3=5
å¹³å‡ç­‰å¾…ï¼š3.0
</pre></div>
</div>
<p><strong>SJF</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>æ—¶é—´çº¿ï¼š|P3(1)|P2(3)|P1(5)|
ç­‰å¾…ï¼šP1=4, P2=2, P3=0
å¹³å‡ç­‰å¾…ï¼š2.0
</pre></div>
</div>
<p><strong>RR (q=2)</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>æ—¶é—´çº¿ï¼š|P1(2)|P2(2)|P1(2)|P3(1)|P2(1)|P1(1)|
ç­‰å¾…ï¼šP1=4, P2=3, P3=2
å¹³å‡ç­‰å¾…ï¼š3.0
</pre></div>
</div>
</section>
<section id="id16">
<h3>6.2 ä¼˜å…ˆçº§åè½¬é—®é¢˜<a class="headerlink" href="#id16" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åœºæ™¯</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Hï¼šé«˜ä¼˜å…ˆçº§ä»»åŠ¡
Mï¼šä¸­ä¼˜å…ˆçº§ä»»åŠ¡
Lï¼šä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆæŒæœ‰é”ï¼‰

1. Lè·å¾—é”ï¼Œè¿è¡Œ
2. Håˆ°è¾¾ï¼ŒæŠ¢å Lï¼Œç­‰å¾…é”
3. Måˆ°è¾¾ï¼ŒæŠ¢å L
4. Mè¿è¡Œï¼ŒHç­‰å¾…ï¼ˆä¼˜å…ˆçº§åè½¬ï¼ï¼‰
</pre></div>
</div>
<p><strong>è§£å†³ï¼šä¼˜å…ˆçº§ç»§æ‰¿</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">priority_inheritance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Lç»§æ‰¿Hçš„ä¼˜å…ˆçº§</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="n">wait_for_lock_held_by</span><span class="p">(</span><span class="n">L</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">L</span><span class="p">.</span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">priority</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">.</span><span class="n">priority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id17">
<h3>6.3 CPUæ—¶é—´æµ‹é‡<a class="headerlink" href="#id17" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">measure_cpu_time</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// æ‰§è¡Œä»»åŠ¡</span>
<span class="w">    </span><span class="n">do_work</span><span class="p">();</span>
<span class="w">    </span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">cpu_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CPUæ—¶é—´: %.3fç§’</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cpu_time</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// æŸ¥çœ‹è¿›ç¨‹CPUä½¿ç”¨æƒ…å†µ</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">get_process_time</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">timespec</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<span class="w">    </span><span class="n">clock_gettime</span><span class="p">(</span><span class="n">CLOCK_PROCESS_CPUTIME_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ts</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;è¿›ç¨‹CPUæ—¶é—´: %ld.%09ldç§’</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">,</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id18">
<h2>7. è°ƒåº¦å™¨è°ƒä¼˜<a class="headerlink" href="#id18" title="Permalink to this heading">ïƒ</a></h2>
<section id="nice">
<h3>7.1 ä¿®æ”¹niceå€¼<a class="headerlink" href="#nice" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># é™ä½ä¼˜å…ˆçº§ï¼ˆæé«˜niceå€¼ï¼‰</span>
nice<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span>./my_program

<span class="c1"># æé«˜ä¼˜å…ˆçº§ï¼ˆé™ä½niceå€¼ï¼Œéœ€è¦rootï¼‰</span>
nice<span class="w"> </span>-n<span class="w"> </span>-10<span class="w"> </span>./my_program

<span class="c1"># ä¿®æ”¹è¿è¡Œä¸­è¿›ç¨‹çš„niceå€¼</span>
renice<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span>-p<span class="w"> </span><span class="m">1234</span>
</pre></div>
</div>
</section>
<section id="id19">
<h3>7.2 è®¾ç½®å®æ—¶ä¼˜å…ˆçº§<a class="headerlink" href="#id19" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sched.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">set_realtime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sched_param</span><span class="w"> </span><span class="n">param</span><span class="p">;</span>
<span class="w">    </span><span class="n">param</span><span class="p">.</span><span class="n">sched_priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1-99</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// è®¾ç½®FIFOè°ƒåº¦</span>
<span class="w">    </span><span class="n">sched_setscheduler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SCHED_FIFO</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">param</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// æˆ–è®¾ç½®RRè°ƒåº¦</span>
<span class="w">    </span><span class="n">sched_setscheduler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SCHED_RR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">param</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id20">
<h3>7.3 CFSè°ƒä¼˜å‚æ•°<a class="headerlink" href="#id20" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># æŸ¥çœ‹CFSå‚æ•°</span>
cat<span class="w"> </span>/proc/sys/kernel/sched_latency_ns<span class="w">        </span><span class="c1"># è°ƒåº¦å»¶è¿Ÿ</span>
cat<span class="w"> </span>/proc/sys/kernel/sched_min_granularity_ns<span class="w"> </span><span class="c1"># æœ€å°ç²’åº¦</span>
cat<span class="w"> </span>/proc/sys/kernel/sched_wakeup_granularity_ns<span class="w"> </span><span class="c1"># å”¤é†’ç²’åº¦</span>

<span class="c1"># ä¿®æ”¹å‚æ•°</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">24000000</span><span class="w"> </span>&gt;<span class="w"> </span>/proc/sys/kernel/sched_latency_ns
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id21">
<h2>8. å¸¸è§é—®é¢˜<a class="headerlink" href="#id21" title="Permalink to this heading">ïƒ</a></h2>
<section id="q1-linuxcfs">
<h3>Q1: ä¸ºä»€ä¹ˆLinuxç”¨CFSè€Œä¸æ˜¯ä¼ ç»Ÿä¼˜å…ˆçº§è°ƒåº¦ï¼Ÿ<a class="headerlink" href="#q1-linuxcfs" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><p>CFSæ›´å…¬å¹³ï¼Œé¿å…é¥¥é¥¿</p></li>
<li><p>è‡ªåŠ¨å¹³è¡¡CPUæ—¶é—´</p></li>
<li><p>é€šè¿‡niceå€¼çµæ´»æ§åˆ¶</p></li>
<li><p>çº¢é»‘æ ‘å®ç°é«˜æ•ˆ</p></li>
</ul>
</section>
<section id="q2">
<h3>Q2: å®æ—¶è°ƒåº¦ä¼šå¯¼è‡´ç³»ç»Ÿå¡æ­»å—ï¼Ÿ<a class="headerlink" href="#q2" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><p>å¯èƒ½ï¼å®æ—¶è¿›ç¨‹ä¼˜å…ˆçº§æé«˜</p></li>
<li><p>æ­»å¾ªç¯çš„å®æ—¶è¿›ç¨‹ä¼šå æ»¡CPU</p></li>
<li><p>Linuxæœ‰ä¿æŠ¤æœºåˆ¶ï¼š<code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/sched_rt_runtime_us</span></code></p></li>
<li><p>é»˜è®¤å®æ—¶è¿›ç¨‹æœ€å¤šå ç”¨95%çš„CPU</p></li>
</ul>
</section>
<section id="q3">
<h3>Q3: å¦‚ä½•é€‰æ‹©æ—¶é—´ç‰‡å¤§å°ï¼Ÿ<a class="headerlink" href="#q3" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><p>è€ƒè™‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼ˆ~1-10Î¼sï¼‰</p></li>
<li><p>I/Oå¯†é›†ï¼šå°æ—¶é—´ç‰‡ï¼ˆå“åº”å¿«ï¼‰</p></li>
<li><p>CPUå¯†é›†ï¼šå¤§æ—¶é—´ç‰‡ï¼ˆå‡å°‘åˆ‡æ¢ï¼‰</p></li>
<li><p>ç»éªŒå€¼ï¼š10-100ms</p></li>
</ul>
</section>
<section id="q4">
<h3>Q4: å¤šæ ¸è°ƒåº¦å¦‚ä½•é¿å…ç¼“å­˜é¢ ç°¸ï¼Ÿ<a class="headerlink" href="#q4" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><p>CPUäº²å’Œæ€§ç»‘å®š</p></li>
<li><p>ä¼˜å…ˆåœ¨æœ¬åœ°æ ¸å¿ƒè°ƒåº¦</p></li>
<li><p>å‡å°‘è¿›ç¨‹è¿ç§»</p></li>
<li><p>NUMAæ„ŸçŸ¥è°ƒåº¦</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id22">
<h2>å‚è€ƒèµ„æº<a class="headerlink" href="#id22" title="Permalink to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p>ã€ŠOperating Systems: Three Easy Piecesã€‹</p></li>
<li><p>Linuxå†…æ ¸æ–‡æ¡£ï¼šDocumentation/scheduler/</p></li>
<li><p>Linuxæºç ï¼š<code class="docutils literal notranslate"><span class="pre">kernel/sched/core.c</span></code>, <code class="docutils literal notranslate"><span class="pre">kernel/sched/fair.c</span></code></p></li>
<li><p>è®ºæ–‡ï¼š<em>Completely Fair Scheduler</em> (2007)</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="è¿›ç¨‹è°ƒåº¦" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../03-memory-management/index.html" class="btn btn-neutral float-right" title="å†…å­˜ç®¡ç†" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Code Dojo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>