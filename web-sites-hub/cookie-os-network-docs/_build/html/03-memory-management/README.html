

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å†…å­˜ç®¡ç† &mdash; OS &amp; Network Core 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2d0851c8" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/copy-code.js?v=caf91246"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="æ–‡ä»¶ç³»ç»Ÿ" href="../04-file-system/index.html" />
    <link rel="prev" title="å†…å­˜ç®¡ç†" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            OS & Network Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ç›®å½•</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">OS &amp; Network Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-process-thread/index.html">è¿›ç¨‹ä¸çº¿ç¨‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-process-scheduling/index.html">è¿›ç¨‹è°ƒåº¦</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">å†…å­˜ç®¡ç†</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">å†…å­˜ç®¡ç†</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">ğŸ’¡ æ ¸å¿ƒç»“è®º</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">1. å†…å­˜å±‚æ¬¡ç»“æ„</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">2. åœ°å€ç©ºé—´</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vs">2.1 ç‰©ç†åœ°å€ vs è™šæ‹Ÿåœ°å€</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.2 å†…å­˜å¸ƒå±€</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">3. åˆ†é¡µæœºåˆ¶</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">3.1 åŸºæœ¬åˆ†é¡µ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">3.2 å¤šçº§é¡µè¡¨</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tlb-translation-lookaside-buffer">3.3 TLBï¼ˆTranslation Lookaside Bufferï¼‰</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">4. åˆ†æ®µæœºåˆ¶</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">4.1 åŸºæœ¬åˆ†æ®µ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">4.2 æ®µé¡µå¼</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">5. é¡µé¢ç½®æ¢ç®—æ³•</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#opt">5.1 æœ€ä¼˜ç®—æ³•ï¼ˆOPTï¼‰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fifo">5.2 å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lru">5.3 æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clock-lru">5.4 Clockç®—æ³•ï¼ˆè¿‘ä¼¼LRUï¼‰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">5.5 å·¥ä½œé›†ç®—æ³•</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#copy-on-write">6. å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">7. å†…å­˜åˆ†é…</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buddy-system">7.1 ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#slab">7.2 Slabåˆ†é…å™¨</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id15">8. å®æˆ˜æ¡ˆä¾‹</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id16">8.1 æµ‹é‡ç¼ºé¡µç‡</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mmap">8.2 mmapå†…å­˜æ˜ å°„</a></li>
<li class="toctree-l4"><a class="reference internal" href="#huge-pages">8.3 å¤§é¡µé¢ï¼ˆHuge Pagesï¼‰</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id17">9. å¸¸è§é—®é¢˜</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#q1">Q1: ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿå†…å­˜ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q2">Q2: é¡µé¢å¤§å°å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q3">Q3: å¦‚ä½•å‡å°‘ç¼ºé¡µä¸­æ–­ï¼Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q4-fork">Q4: ä¸ºä»€ä¹ˆforké‚£ä¹ˆå¿«ï¼Ÿ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id18">å‚è€ƒèµ„æº</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../04-file-system/index.html">æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-concurrency-sync/index.html">å¹¶å‘ä¸åŒæ­¥</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-deadlock/index.html">æ­»é”å¤„ç†</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-tcp-ip/index.html">TCP-IPåè®®è¯¦è§£</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-http/index.html">HTTPåè®®ä¸å®æˆ˜</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09-socket/index.html">Socketç¼–ç¨‹å®æˆ˜</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10-network-tools/index.html">ç½‘ç»œå·¥å…·å¤§å…¨</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11-network-security/index.html">ç½‘ç»œå®‰å…¨åŸºç¡€</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OS & Network Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">å†…å­˜ç®¡ç†</a></li>
      <li class="breadcrumb-item active">å†…å­˜ç®¡ç†</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/03-memory-management/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>å†…å­˜ç®¡ç†<a class="headerlink" href="#id1" title="Permalink to this heading">ïƒ</a></h1>
<section id="id2">
<h2>ğŸ’¡ æ ¸å¿ƒç»“è®º<a class="headerlink" href="#id2" title="Permalink to this heading">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>è™šæ‹Ÿå†…å­˜æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿçš„åŸºçŸ³ï¼Œæä¾›è¿›ç¨‹éš”ç¦»å’Œå†…å­˜æŠ½è±¡</strong></p></li>
<li><p><strong>åˆ†é¡µæ¯”åˆ†æ®µæ›´çµæ´»ï¼Œæ®µé¡µå¼ç»“åˆä¸¤è€…ä¼˜ç‚¹</strong></p></li>
<li><p><strong>å¤šçº§é¡µè¡¨å‡å°‘å†…å­˜å ç”¨ï¼ŒTLBåŠ é€Ÿåœ°å€è½¬æ¢</strong></p></li>
<li><p><strong>LRUæ˜¯æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•çš„è¿‘ä¼¼ï¼ŒClockç®—æ³•æ˜¯LRUçš„é«˜æ•ˆå®ç°</strong></p></li>
<li><p><strong>å†™æ—¶å¤åˆ¶(COW)æ˜¯forkå’Œå†…å­˜ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯</strong></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="id3">
<h2>1. å†…å­˜å±‚æ¬¡ç»“æ„<a class="headerlink" href="#id3" title="Permalink to this heading">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">å¯„å­˜å™¨</span>  <span class="o">&lt;</span><span class="mi">1</span><span class="n">ns</span>   <span class="n">KBçº§</span>    <span class="n">æœ€å¿«</span>
<span class="n">L1ç¼“å­˜</span>  <span class="o">~</span><span class="mi">1</span><span class="n">ns</span>   <span class="mi">32</span><span class="o">-</span><span class="mi">64</span><span class="n">KB</span>
<span class="n">L2ç¼“å­˜</span>  <span class="o">~</span><span class="mi">4</span><span class="n">ns</span>   <span class="mi">256</span><span class="n">KB</span><span class="o">-</span><span class="mi">1</span><span class="n">MB</span>
<span class="n">L3ç¼“å­˜</span>  <span class="o">~</span><span class="mi">10</span><span class="n">ns</span>  <span class="mi">8</span><span class="o">-</span><span class="mi">32</span><span class="n">MB</span>
<span class="n">å†…å­˜</span>    <span class="o">~</span><span class="mi">100</span><span class="n">ns</span> <span class="n">GBçº§</span>
<span class="n">SSD</span>     <span class="o">~</span><span class="mi">10</span><span class="n">Î¼s</span>  <span class="n">TBçº§</span>
<span class="n">HDD</span>     <span class="o">~</span><span class="mi">10</span><span class="n">ms</span>  <span class="n">TBçº§</span>    <span class="n">æœ€æ…¢</span>
</pre></div>
</div>
<p><strong>å±€éƒ¨æ€§åŸç†</strong>ï¼š</p>
<ul class="simple">
<li><p><strong>æ—¶é—´å±€éƒ¨æ€§</strong>ï¼šæœ€è¿‘è®¿é—®çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è®¿é—®</p></li>
<li><p><strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼šç›¸é‚»åœ°å€çš„æ•°æ®å¾ˆå¯èƒ½è¢«è®¿é—®</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id4">
<h2>2. åœ°å€ç©ºé—´<a class="headerlink" href="#id4" title="Permalink to this heading">ïƒ</a></h2>
<section id="vs">
<h3>2.1 ç‰©ç†åœ°å€ vs è™šæ‹Ÿåœ°å€<a class="headerlink" href="#vs" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ç‰©ç†åœ°å€ï¼šå®é™…å†…å­˜åœ°å€
è™šæ‹Ÿåœ°å€ï¼šç¨‹åºä½¿ç”¨çš„åœ°å€

è¿›ç¨‹A: 0x1000 â”€â”
              â”œâ”€&gt; ç‰©ç†åœ°å€: 0x5000
è¿›ç¨‹B: 0x1000 â”€â”˜  (æ˜ å°„åˆ°ä¸åŒç‰©ç†é¡µ)
</pre></div>
</div>
<p><strong>è™šæ‹Ÿåœ°å€çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ol class="arabic simple">
<li><p>è¿›ç¨‹éš”ç¦»ï¼ˆå®‰å…¨ï¼‰</p></li>
<li><p>å†…å­˜ç¢ç‰‡æ•´ç†ï¼ˆçµæ´»ï¼‰</p></li>
<li><p>ç¨‹åºé‡å®šä½ï¼ˆç®€å•ï¼‰</p></li>
<li><p>å…±äº«å†…å­˜ï¼ˆé«˜æ•ˆï¼‰</p></li>
</ol>
</section>
<section id="id5">
<h3>2.2 å†…å­˜å¸ƒå±€<a class="headerlink" href="#id5" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>// å…¸å‹çš„è¿›ç¨‹å†…å­˜å¸ƒå±€ï¼ˆ32ä½ï¼‰

0xFFFFFFFF  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   å†…æ ¸ç©ºé—´   â”‚ 1GB
0xC0000000  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚     æ ˆ       â”‚ â†“ å‘ä¸‹å¢é•¿
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚      â†•      â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚     å †       â”‚ â†‘ å‘ä¸Šå¢é•¿
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   BSSæ®µ     â”‚ æœªåˆå§‹åŒ–æ•°æ®
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   æ•°æ®æ®µ     â”‚ å·²åˆå§‹åŒ–æ•°æ®
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   ä»£ç æ®µ     â”‚ åªè¯»
0x08048000  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   ä¿ç•™åŒº     â”‚
0x00000000  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></div>
</div>
<p><strong>æŸ¥çœ‹è¿›ç¨‹å†…å­˜å¸ƒå±€</strong>ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">global_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">       </span><span class="c1">// æ•°æ®æ®µ</span>
<span class="kt">int</span><span class="w"> </span><span class="n">global_uninit</span><span class="p">;</span><span class="w">          </span><span class="c1">// BSSæ®µ</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">     </span><span class="c1">// ä»£ç æ®µï¼ˆåªè¯»ï¼‰</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">stack_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">     </span><span class="c1">// æ ˆ</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">heap_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span><span class="w">  </span><span class="c1">// å †</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;ä»£ç æ®µ: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;æ•°æ®æ®µ: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">global_init</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;BSSæ®µ:  %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">global_uninit</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;å †:    %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">heap_var</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;æ ˆ:    %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stack_var</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id6">
<h2>3. åˆ†é¡µæœºåˆ¶<a class="headerlink" href="#id6" title="Permalink to this heading">ïƒ</a></h2>
<section id="id7">
<h3>3.1 åŸºæœ¬åˆ†é¡µ<a class="headerlink" href="#id7" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šå°†è™šæ‹Ÿåœ°å€ç©ºé—´å’Œç‰©ç†å†…å­˜éƒ½åˆ†æˆå›ºå®šå¤§å°çš„é¡µ</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>é¡µå¤§å°ï¼šé€šå¸¸4KB

è™šæ‹Ÿåœ°å€ = [é¡µå· | é¡µå†…åç§»]
ä¾‹å¦‚ï¼ˆ32ä½ï¼Œ4KBé¡µï¼‰ï¼š
  20ä½é¡µå· + 12ä½åç§»
  æ”¯æŒï¼š2^20 = 1Mä¸ªé¡µ = 4GBåœ°å€ç©ºé—´
</pre></div>
</div>
<p><strong>åœ°å€è½¬æ¢</strong>ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">page_table_entry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">present</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">    </span><span class="c1">// åœ¨å†…å­˜ä¸­</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">writable</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// å¯å†™</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">       </span><span class="c1">// ç”¨æˆ·å¯è®¿é—®</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// å·²è®¿é—®</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dirty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// å·²ä¿®æ”¹</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pfn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">       </span><span class="c1">// ç‰©ç†é¡µæ¡†å· (Page Frame Number)</span>
<span class="p">};</span>

<span class="c1">// åœ°å€è½¬æ¢å‡½æ•°</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">virtual_addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtual_addr</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w">  </span><span class="c1">// é«˜20ä½</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtual_addr</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFFF</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä½12ä½</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">page_table_entry</span><span class="w"> </span><span class="n">pte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page_table</span><span class="p">[</span><span class="n">page_num</span><span class="p">];</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pte</span><span class="p">.</span><span class="n">present</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_fault</span><span class="p">();</span><span class="w">  </span><span class="c1">// ç¼ºé¡µä¸­æ–­</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">physical_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pte</span><span class="p">.</span><span class="n">pfn</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">physical_addr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3>3.2 å¤šçº§é¡µè¡¨<a class="headerlink" href="#id8" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>é—®é¢˜</strong>ï¼š32ä½ç³»ç»Ÿï¼Œ4KBé¡µï¼Œé¡µè¡¨å¤§å° = 2^20 * 4B = 4MBï¼ˆæ¯ä¸ªè¿›ç¨‹ï¼ï¼‰</p>
<p><strong>è§£å†³</strong>ï¼šå¤šçº§é¡µè¡¨</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ä¸¤çº§é¡µè¡¨ï¼ˆ32ä½ï¼‰ï¼š
è™šæ‹Ÿåœ°å€ = [10ä½ä¸€çº§é¡µå· | 10ä½äºŒçº§é¡µå· | 12ä½åç§»]

ä¸€çº§é¡µè¡¨ï¼š1024é¡¹ = 4KB
äºŒçº§é¡µè¡¨ï¼š1024é¡¹ = 4KBï¼ˆæŒ‰éœ€åˆ†é…ï¼‰

èŠ‚çœï¼šåªéœ€ä¸€çº§é¡µè¡¨ + å®é™…ä½¿ç”¨çš„äºŒçº§é¡µè¡¨
</pre></div>
</div>
<p><strong>åœ°å€è½¬æ¢</strong>ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// ä¸¤çº§é¡µè¡¨è½¬æ¢</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">translate_2level</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">va</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pde_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">va</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x3FF</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä¸€çº§ç´¢å¼•</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pte_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">va</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x3FF</span><span class="p">;</span><span class="w">  </span><span class="c1">// äºŒçº§ç´¢å¼•</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFFF</span><span class="p">;</span><span class="w">             </span><span class="c1">// åç§»</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 1. æŸ¥ä¸€çº§é¡µè¡¨</span>
<span class="w">    </span><span class="n">pde_t</span><span class="w"> </span><span class="n">pde</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page_directory</span><span class="p">[</span><span class="n">pde_index</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pde</span><span class="p">.</span><span class="n">present</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_fault</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 2. æŸ¥äºŒçº§é¡µè¡¨</span>
<span class="w">    </span><span class="n">pte_t</span><span class="w"> </span><span class="o">*</span><span class="n">page_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pte_t</span><span class="o">*</span><span class="p">)</span><span class="n">pde</span><span class="p">.</span><span class="n">pt_base</span><span class="p">;</span>
<span class="w">    </span><span class="n">pte_t</span><span class="w"> </span><span class="n">pte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page_table</span><span class="p">[</span><span class="n">pte_index</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pte</span><span class="p">.</span><span class="n">present</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_fault</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 3. ç»„åˆç‰©ç†åœ°å€</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">pte</span><span class="p">.</span><span class="n">pfn</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Linux x86-64 å››çº§é¡µè¡¨</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PGD (Page Global Directory)  -&gt; å…¨å±€é¡µç›®å½•
PUD (Page Upper Directory)   -&gt; ä¸Šå±‚é¡µç›®å½•
PMD (Page Middle Directory)  -&gt; ä¸­é—´é¡µç›®å½•
PTE (Page Table Entry)       -&gt; é¡µè¡¨é¡¹

è™šæ‹Ÿåœ°å€ï¼ˆ48ä½ï¼‰ï¼š
[9ä½PGD | 9ä½PUD | 9ä½PMD | 9ä½PTE | 12ä½åç§»]
</pre></div>
</div>
</section>
<section id="tlb-translation-lookaside-buffer">
<h3>3.3 TLBï¼ˆTranslation Lookaside Bufferï¼‰<a class="headerlink" href="#tlb-translation-lookaside-buffer" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>é—®é¢˜</strong>ï¼šæ¯æ¬¡å†…å­˜è®¿é—®éœ€è¦å¤šæ¬¡é¡µè¡¨æŸ¥è¯¢</p>
<p><strong>è§£å†³</strong>ï¼šTLBç¼“å­˜æœ€è¿‘çš„åœ°å€è½¬æ¢</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">tlb_entry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vpn</span><span class="p">;</span><span class="w">  </span><span class="c1">// è™šæ‹Ÿé¡µå·</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pfn</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç‰©ç†é¡µæ¡†å·</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">valid</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">tlb_entry</span><span class="w"> </span><span class="n">tlb</span><span class="p">[</span><span class="n">TLB_SIZE</span><span class="p">];</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">translate_with_tlb</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">va</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vpn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFFF</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 1. æŸ¥TLB</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">TLB_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tlb</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tlb</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">vpn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">vpn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// TLBå‘½ä¸­</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">tlb</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pfn</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 2. TLBæœªå‘½ä¸­ï¼ŒæŸ¥é¡µè¡¨</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pfn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page_table_walk</span><span class="p">(</span><span class="n">vpn</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 3. æ›´æ–°TLB</span>
<span class="w">    </span><span class="n">tlb_insert</span><span class="p">(</span><span class="n">vpn</span><span class="p">,</span><span class="w"> </span><span class="n">pfn</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">pfn</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>TLBæ€§èƒ½</strong>ï¼š</p>
<ul class="simple">
<li><p>TLBå¤§å°ï¼š64-1024é¡¹</p></li>
<li><p>å‘½ä¸­ç‡ï¼š&gt;95%</p></li>
<li><p>å‘½ä¸­æ—¶é—´ï¼š~1ns</p></li>
<li><p>æœªå‘½ä¸­æ—¶é—´ï¼š~100ns</p></li>
</ul>
<p><strong>TLBåˆ·æ–°</strong>ï¼š</p>
<ul class="simple">
<li><p>è¿›ç¨‹åˆ‡æ¢æ—¶éœ€è¦åˆ·æ–°TLBï¼ˆå¼€é”€å¤§ï¼ï¼‰</p></li>
<li><p>è§£å†³ï¼šASIDï¼ˆAddress Space IDï¼‰æ ‡è®°è¿›ç¨‹</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id9">
<h2>4. åˆ†æ®µæœºåˆ¶<a class="headerlink" href="#id9" title="Permalink to this heading">ïƒ</a></h2>
<section id="id10">
<h3>4.1 åŸºæœ¬åˆ†æ®µ<a class="headerlink" href="#id10" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæŒ‰é€»è¾‘å•å…ƒï¼ˆä»£ç ã€æ•°æ®ã€æ ˆï¼‰åˆ†æ®µ</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">segment</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">base</span><span class="p">;</span><span class="w">      </span><span class="c1">// æ®µåŸºå€</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">limit</span><span class="p">;</span><span class="w">     </span><span class="c1">// æ®µé•¿åº¦</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w">     </span><span class="c1">// æ®µç±»å‹ï¼ˆä»£ç /æ•°æ®ï¼‰</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">privilege</span><span class="p">;</span><span class="w"> </span><span class="c1">// ç‰¹æƒçº§</span>
<span class="p">};</span>

<span class="n">segment</span><span class="w"> </span><span class="n">segment_table</span><span class="p">[</span><span class="n">MAX_SEGMENTS</span><span class="p">];</span>

<span class="c1">// åœ°å€è½¬æ¢</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">translate_segment</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seg</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">segment_table</span><span class="p">[</span><span class="n">seg</span><span class="p">].</span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">segmentation_fault</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">segment_table</span><span class="p">[</span><span class="n">seg</span><span class="p">].</span><span class="n">base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>ç¬¦åˆç¨‹åºé€»è¾‘ç»“æ„</p></li>
<li><p>ä¿æŠ¤ç²’åº¦çµæ´»</p></li>
<li><p>å…±äº«æ–¹ä¾¿</p></li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul class="simple">
<li><p>å¤–éƒ¨ç¢ç‰‡ï¼ˆä¸åŒå¤§å°çš„æ®µï¼‰</p></li>
<li><p>æ®µè¡¨ç®¡ç†å¤æ‚</p></li>
</ul>
</section>
<section id="id11">
<h3>4.2 æ®µé¡µå¼<a class="headerlink" href="#id11" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>ç»“åˆåˆ†æ®µå’Œåˆ†é¡µçš„ä¼˜ç‚¹</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>è™šæ‹Ÿåœ°å€ = [æ®µå· | é¡µå· | é¡µå†…åç§»]

1. å…ˆç”¨æ®µå·æŸ¥æ®µè¡¨ï¼Œå¾—åˆ°é¡µè¡¨åŸºå€
2. ç”¨é¡µå·æŸ¥é¡µè¡¨ï¼Œå¾—åˆ°ç‰©ç†é¡µæ¡†å·
3. ç»„åˆç‰©ç†åœ°å€
</pre></div>
</div>
<p><strong>Intel x86çš„æ®µé¡µå¼</strong>ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>æ®µé€‰æ‹©å­ï¼š13ä½ç´¢å¼• + 1ä½TI + 2ä½RPL
æ®µæè¿°ç¬¦ï¼šåŸºå€ + é™é•¿ + å±æ€§
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id12">
<h2>5. é¡µé¢ç½®æ¢ç®—æ³•<a class="headerlink" href="#id12" title="Permalink to this heading">ïƒ</a></h2>
<section id="opt">
<h3>5.1 æœ€ä¼˜ç®—æ³•ï¼ˆOPTï¼‰<a class="headerlink" href="#opt" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæ›¿æ¢æœªæ¥æœ€é•¿æ—¶é—´ä¸ç”¨çš„é¡µï¼ˆç†è®ºæœ€ä¼˜ï¼‰</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">opt_replace</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pages</span><span class="p">[],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¯¹æ¯ä¸ªé¡µé¢ï¼Œè®¡ç®—ä¸‹æ¬¡ä½¿ç”¨æ—¶é—´</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">farthest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next_use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_next_use</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_use</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">farthest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">farthest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_use</span><span class="p">;</span>
<span class="w">            </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">victim</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>é—®é¢˜</strong>ï¼šæ— æ³•é¢„çŸ¥æœªæ¥ï¼Œä»…ç”¨äºæ€§èƒ½å¯¹æ¯”</p>
</section>
<section id="fifo">
<h3>5.2 å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰<a class="headerlink" href="#fifo" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæ›¿æ¢æœ€æ—©è¿›å…¥çš„é¡µ</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">fifo_replace</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pointer</span><span class="p">;</span>
<span class="w">    </span><span class="n">pointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pointer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">victim</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Beladyå¼‚å¸¸</strong>ï¼šå¢åŠ é¡µæ¡†æ•°åè€Œå¢åŠ ç¼ºé¡µç‡ï¼</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>é¡µé¢å¼•ç”¨åºåˆ—ï¼š1 2 3 4 1 2 5 1 2 3 4 5

3ä¸ªé¡µæ¡†ï¼šç¼ºé¡µ9æ¬¡
1 2 3 4 1 2 5 1 2 3 4 5
1 1 1 4 4 4 5 5 5 3 3 3
  2 2 2 1 1 1 1 1 1 4 4
    3 3 3 2 2 2 2 2 2 2 5
    *   * * * *     * * *

4ä¸ªé¡µæ¡†ï¼šç¼ºé¡µ10æ¬¡ï¼ˆæ›´å¤šï¼ï¼‰
</pre></div>
</div>
</section>
<section id="lru">
<h3>5.3 æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰<a class="headerlink" href="#lru" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šæ›¿æ¢æœ€é•¿æ—¶é—´æœªä½¿ç”¨çš„é¡µ</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// æ–¹æ¡ˆ1ï¼šæ—¶é—´æˆ³</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">frame_num</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">last_use_time</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">lru_replace_timestamp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">oldest_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INT_MAX</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">last_use_time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">oldest_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">oldest_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">last_use_time</span><span class="p">;</span>
<span class="w">            </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">victim</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// æ–¹æ¡ˆ2ï¼šé“¾è¡¨</span>
<span class="c1">// æœ€è¿‘ä½¿ç”¨çš„æ”¾é“¾è¡¨å¤´ï¼Œæ›¿æ¢æ—¶é€‰é“¾è¡¨å°¾</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">lru_list</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">head</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">lru_access</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç§»åˆ°é“¾è¡¨å¤´</span>
<span class="w">    </span><span class="n">list_move</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pages</span><span class="p">[</span><span class="n">page_num</span><span class="p">].</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lru_list</span><span class="p">.</span><span class="n">head</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">lru_replace_list</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è¿”å›é“¾è¡¨å°¾</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">list_last_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lru_list</span><span class="p">.</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>æ€§èƒ½</strong>ï¼š</p>
<ul class="simple">
<li><p>ç†è®ºä¸Šæ¥è¿‘OPT</p></li>
<li><p>å®ç°å¼€é”€å¤§ï¼ˆæ¯æ¬¡è®¿é—®éƒ½è¦æ›´æ–°ï¼‰</p></li>
</ul>
</section>
<section id="clock-lru">
<h3>5.4 Clockç®—æ³•ï¼ˆè¿‘ä¼¼LRUï¼‰<a class="headerlink" href="#clock-lru" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šå¾ªç¯æ‰«æï¼Œç»™ç¬¬äºŒæ¬¡æœºä¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">page_frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_num</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">reference_bit</span><span class="p">;</span><span class="w">  </span><span class="c1">// è®¿é—®ä½</span>
<span class="p">};</span>

<span class="n">page_frame</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">CAPACITY</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">clock_replace</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ‰¾åˆ°å—å®³é¡µ</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock_hand</span><span class="p">;</span>
<span class="w">            </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">clock_hand</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">CAPACITY</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">victim</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ç»™ç¬¬äºŒæ¬¡æœºä¼š</span>
<span class="w">            </span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">clock_hand</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">CAPACITY</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// é¡µé¢è®¿é—®æ—¶è®¾ç½®è®¿é—®ä½</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">page_access</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CAPACITY</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">page_num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>æ”¹è¿›ï¼šClock-æ”¹è¿›ç®—æ³•</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// è€ƒè™‘è®¿é—®ä½å’Œä¿®æ”¹ä½</span>
<span class="c1">// (reference, dirty)</span>
<span class="c1">// (0, 0) - æœ€ä½³æ›¿æ¢</span>
<span class="c1">// (0, 1) - éœ€è¦å†™å›</span>
<span class="c1">// (1, 0) - æœ€è¿‘è®¿é—®</span>
<span class="c1">// (1, 1) - æœ€è¿‘è®¿é—®ä¸”ä¿®æ”¹</span>
</pre></div>
</div>
</section>
<section id="id13">
<h3>5.5 å·¥ä½œé›†ç®—æ³•<a class="headerlink" href="#id13" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>å·¥ä½œé›†</strong>ï¼šæœ€è¿‘Î”ä¸ªæ—¶é—´å•ä½å†…è®¿é—®çš„é¡µé¢é›†åˆ</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">working_set</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pages</span><span class="p">[</span><span class="n">MAX_PAGES</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">access_time</span><span class="p">[</span><span class="n">MAX_PAGES</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update_working_set</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">current_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç§»é™¤æ—¶é—´çª—å£å¤–çš„é¡µé¢</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ws</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ws</span><span class="p">.</span><span class="n">access_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DELTA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">remove_page</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// æ·»åŠ æ–°é¡µé¢</span>
<span class="w">    </span><span class="n">add_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">current_time</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="copy-on-write">
<h2>6. å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰<a class="headerlink" href="#copy-on-write" title="Permalink to this heading">ïƒ</a></h2>
<p><strong>åŸç†</strong>ï¼šforkæ—¶ä¸å¤åˆ¶å†…å­˜ï¼Œåªæœ‰å†™å…¥æ—¶æ‰å¤åˆ¶</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">fork_cow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. å¤åˆ¶é¡µè¡¨</span>
<span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">page_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy_page_table</span><span class="p">(</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">page_table</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 2. æ ‡è®°æ‰€æœ‰é¡µä¸ºåªè¯»</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_PAGES</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">page_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">page_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 3. å¼•ç”¨è®¡æ•°+1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_PAGES</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_ref_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">page_fault_handler</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">page_ref_count</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// å†™æ—¶å¤åˆ¶</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">new_page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_page</span><span class="p">();</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">new_page</span><span class="p">,</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">page_num</span><span class="p">],</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">);</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">page_table</span><span class="p">[</span><span class="n">page_num</span><span class="p">].</span><span class="n">pfn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_pfn</span><span class="p">(</span><span class="n">new_page</span><span class="p">);</span>
<span class="w">        </span><span class="n">page_table</span><span class="p">[</span><span class="n">page_num</span><span class="p">].</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">page_ref_count</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// åªæœ‰ä¸€ä¸ªå¼•ç”¨ï¼Œç›´æ¥æ”¹ä¸ºå¯å†™</span>
<span class="w">        </span><span class="n">page_table</span><span class="p">[</span><span class="n">page_num</span><span class="p">].</span><span class="n">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul class="simple">
<li><p>forké€Ÿåº¦å¿«</p></li>
<li><p>èŠ‚çœå†…å­˜</p></li>
<li><p>forkåç«‹å³execçš„åœºæ™¯æ•ˆç‡æé«˜</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id14">
<h2>7. å†…å­˜åˆ†é…<a class="headerlink" href="#id14" title="Permalink to this heading">ïƒ</a></h2>
<section id="buddy-system">
<h3>7.1 ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰<a class="headerlink" href="#buddy-system" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼š2çš„å¹‚æ¬¡åˆ†é…ï¼Œç›¸é‚»å—å¯åˆå¹¶</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MAX_ORDER 11  </span><span class="c1">// æ”¯æŒ2^0åˆ°2^10é¡µ</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">free_area</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">free_list</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nr_free</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">free_area</span><span class="w"> </span><span class="n">free_area</span><span class="p">[</span><span class="n">MAX_ORDER</span><span class="p">];</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">buddy_alloc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. æ‰¾åˆ°æ»¡è¶³å¤§å°çš„å—</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_ORDER</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">free_area</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">free_list</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_first_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">free_area</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">free_list</span><span class="p">);</span>
<span class="w">            </span><span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
<span class="w">            </span>
<span class="w">            </span><span class="c1">// 2. åˆ†è£‚å¤§å—</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">i</span><span class="o">--</span><span class="p">;</span>
<span class="w">                </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buddy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">;</span>
<span class="w">                </span><span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buddy</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">free_area</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">free_list</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">block</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="c1">// å†…å­˜ä¸è¶³</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">buddy_free</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å°è¯•åˆå¹¶ä¼™ä¼´</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_ORDER</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buddy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_buddy</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">);</span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_free</span><span class="p">(</span><span class="n">buddy</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="c1">// ä¼™ä¼´ä¸ç©ºé—²</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1">// åˆå¹¶</span>
<span class="w">        </span><span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buddy</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buddy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buddy</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">order</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// åŠ å…¥ç©ºé—²é“¾è¡¨</span>
<span class="w">    </span><span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">free_area</span><span class="p">[</span><span class="n">order</span><span class="p">].</span><span class="n">free_list</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="slab">
<h3>7.2 Slabåˆ†é…å™¨<a class="headerlink" href="#slab" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>åŸç†</strong>ï¼šä¸ºå¸¸ç”¨å¤§å°é¢„åˆ†é…å¯¹è±¡ç¼“å­˜</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">kmem_cache</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ctor</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ„é€ å‡½æ•°</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">slabs_full</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">slabs_partial</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">slabs_free</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">kmem_cache_alloc</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">kmem_cache</span><span class="w"> </span><span class="o">*</span><span class="n">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. ä¼˜å…ˆä»partial slabåˆ†é…</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_partial</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">slab</span><span class="w"> </span><span class="o">*</span><span class="n">slab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_first_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_partial</span><span class="p">);</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_alloc</span><span class="p">(</span><span class="n">slab</span><span class="p">);</span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">slab_full</span><span class="p">(</span><span class="n">slab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">list_move</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_full</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 2. ä»free slabåˆ†é…</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_free</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">slab</span><span class="w"> </span><span class="o">*</span><span class="n">slab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_first_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_free</span><span class="p">);</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slab_alloc</span><span class="p">(</span><span class="n">slab</span><span class="p">);</span>
<span class="w">        </span><span class="n">list_move</span><span class="p">(</span><span class="o">&amp;</span><span class="n">slab</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">slabs_partial</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// 3. åˆ†é…æ–°slab</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">slab</span><span class="w"> </span><span class="o">*</span><span class="n">new_slab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_slab</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">slab_alloc</span><span class="p">(</span><span class="n">new_slab</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="id15">
<h2>8. å®æˆ˜æ¡ˆä¾‹<a class="headerlink" href="#id15" title="Permalink to this heading">ïƒ</a></h2>
<section id="id16">
<h3>8.1 æµ‹é‡ç¼ºé¡µç‡<a class="headerlink" href="#id16" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/time.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/resource.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">measure_page_faults</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">rusage</span><span class="w"> </span><span class="n">usage</span><span class="p">;</span>
<span class="w">    </span><span class="n">getrusage</span><span class="p">(</span><span class="n">RUSAGE_SELF</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">usage</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;ä¸»ç¼ºé¡µ: %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usage</span><span class="p">.</span><span class="n">ru_majflt</span><span class="p">);</span><span class="w">  </span><span class="c1">// éœ€è¦ç£ç›˜I/O</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;æ¬¡ç¼ºé¡µ: %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usage</span><span class="p">.</span><span class="n">ru_minflt</span><span class="p">);</span><span class="w">  </span><span class="c1">// åªéœ€åˆ†é…ç‰©ç†é¡µ</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mmap">
<h3>8.2 mmapå†…å­˜æ˜ å°„<a class="headerlink" href="#mmap" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mman.h&gt;</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="n">PROT_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PROT_WRITE</span><span class="p">,</span>
<span class="w">                </span><span class="n">MAP_PRIVATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MAP_ANONYMOUS</span><span class="p">,</span>
<span class="w">                </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// ä½¿ç”¨å†…å­˜...</span>

<span class="n">munmap</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="huge-pages">
<h3>8.3 å¤§é¡µé¢ï¼ˆHuge Pagesï¼‰<a class="headerlink" href="#huge-pages" title="Permalink to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># é…ç½®å¤§é¡µé¢ï¼ˆ2MBï¼‰</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>&gt;<span class="w"> </span>/proc/sys/vm/nr_hugepages

<span class="c1"># æŸ¥çœ‹å¤§é¡µé¢ä½¿ç”¨æƒ…å†µ</span>
cat<span class="w"> </span>/proc/meminfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Huge
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// ä½¿ç”¨å¤§é¡µé¢</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span>
<span class="w">                </span><span class="n">PROT_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PROT_WRITE</span><span class="p">,</span>
<span class="w">                </span><span class="n">MAP_PRIVATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MAP_ANONYMOUS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MAP_HUGETLB</span><span class="p">,</span>
<span class="w">                </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul class="simple">
<li><p>å‡å°‘TLBæœªå‘½ä¸­</p></li>
<li><p>å‡å°‘é¡µè¡¨å¤§å°</p></li>
<li><p>é€‚åˆå¤§å†…å­˜åº”ç”¨</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id17">
<h2>9. å¸¸è§é—®é¢˜<a class="headerlink" href="#id17" title="Permalink to this heading">ïƒ</a></h2>
<section id="q1">
<h3>Q1: ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿå†…å­˜ï¼Ÿ<a class="headerlink" href="#q1" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ol class="arabic simple">
<li><p>è¿›ç¨‹éš”ç¦»å’Œä¿æŠ¤</p></li>
<li><p>ç®€åŒ–å†…å­˜ç®¡ç†</p></li>
<li><p>æ”¯æŒè¿›ç¨‹é—´å…±äº«</p></li>
<li><p>å…è®¸ä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤§çš„åœ°å€ç©ºé—´</p></li>
</ol>
</section>
<section id="q2">
<h3>Q2: é¡µé¢å¤§å°å¦‚ä½•é€‰æ‹©ï¼Ÿ<a class="headerlink" href="#q2" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><p>å°é¡µé¢ï¼šå‡å°‘å†…éƒ¨ç¢ç‰‡ï¼Œä½†é¡µè¡¨å¤§</p></li>
<li><p>å¤§é¡µé¢ï¼šå‡å°‘é¡µè¡¨å¤§å°å’ŒTLBæœªå‘½ä¸­ï¼Œä½†å†…éƒ¨ç¢ç‰‡å¤š</p></li>
<li><p>å¸¸ç”¨ï¼š4KBï¼ˆé€šç”¨ï¼‰ï¼Œ2MBï¼ˆå¤§é¡µé¢ï¼‰</p></li>
</ul>
</section>
<section id="q3">
<h3>Q3: å¦‚ä½•å‡å°‘ç¼ºé¡µä¸­æ–­ï¼Ÿ<a class="headerlink" href="#q3" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>:</p>
<ol class="arabic simple">
<li><p>å¢åŠ ç‰©ç†å†…å­˜</p></li>
<li><p>ä¼˜åŒ–é¡µé¢ç½®æ¢ç®—æ³•</p></li>
<li><p>ä½¿ç”¨å±€éƒ¨æ€§åŸç†</p></li>
<li><p>é¢„å–ç­–ç•¥</p></li>
<li><p>ä½¿ç”¨å¤§é¡µé¢</p></li>
</ol>
</section>
<section id="q4-fork">
<h3>Q4: ä¸ºä»€ä¹ˆforké‚£ä¹ˆå¿«ï¼Ÿ<a class="headerlink" href="#q4-fork" title="Permalink to this heading">ïƒ</a></h3>
<p><strong>A</strong>: å†™æ—¶å¤åˆ¶ï¼åªå¤åˆ¶é¡µè¡¨ï¼Œä¸å¤åˆ¶å®é™…æ•°æ®</p>
</section>
</section>
<hr class="docutils" />
<section id="id18">
<h2>å‚è€ƒèµ„æº<a class="headerlink" href="#id18" title="Permalink to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹(CSAPP) - ç¬¬9ç« </p></li>
<li><p>ã€ŠOperating Systems: Three Easy Piecesã€‹</p></li>
<li><p>Linuxæºç ï¼š<code class="docutils literal notranslate"><span class="pre">mm/memory.c</span></code>, <code class="docutils literal notranslate"><span class="pre">mm/page_alloc.c</span></code></p></li>
<li><p>Intelæ‰‹å†Œï¼šã€ŠIntel 64 and IA-32 Architectures Software Developerâ€™s Manualã€‹</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="å†…å­˜ç®¡ç†" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../04-file-system/index.html" class="btn btn-neutral float-right" title="æ–‡ä»¶ç³»ç»Ÿ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Code Dojo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>