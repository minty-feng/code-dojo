# 02-æµ‹è¯•æŠ€æœ¯

## ğŸ“‹ å­¦ä¹ ç›®æ ‡
- æŒæ¡å•å…ƒæµ‹è¯•ç¼–å†™
- å­¦ä¹ ç»„ä»¶æµ‹è¯•æŠ€å·§
- ç†è§£E2Eæµ‹è¯•æµç¨‹
- æŒæ¡æµ‹è¯•è¦†ç›–ç‡åˆ†æ

## ğŸ§ª æµ‹è¯•æ¡†æ¶

### Vitestï¼ˆæ¨èï¼‰
```bash
# å®‰è£…
pnpm add -D vitest @vitest/ui

# package.json
{
    "scripts": {
        "test": "vitest",
        "test:ui": "vitest --ui",
        "test:coverage": "vitest --coverage"
    }
}
```

### åŸºæœ¬é…ç½®
```javascript
// vitest.config.ts
import {defineConfig} from 'vitest/config';

export default defineConfig({
    test: {
        environment: 'jsdom', // æˆ–'node', 'happy-dom'
        globals: true,
        setupFiles: './tests/setup.ts',
        coverage: {
            provider: 'v8',
            reporter: ['text', 'json', 'html']
        }
    }
});
```

## ğŸ“ å•å…ƒæµ‹è¯•

### åŸºæœ¬æ–­è¨€
```javascript
import {describe, it, expect} from 'vitest';

describe('Math utils', () => {
    it('should add two numbers', () => {
        expect(1 + 1).toBe(2);
    });
    
    it('should multiply numbers', () => {
        const result = multiply(3, 4);
        expect(result).toBe(12);
        expect(result).toBeGreaterThan(10);
        expect(result).toBeLessThan(20);
    });
    
    it('should handle objects', () => {
        const user = {name: 'John', age: 30};
        expect(user).toEqual({name: 'John', age: 30});
        expect(user).toHaveProperty('name');
        expect(user).toMatchObject({name: 'John'});
    });
    
    it('should handle arrays', () => {
        const arr = [1, 2, 3];
        expect(arr).toHaveLength(3);
        expect(arr).toContain(2);
        expect(arr).toEqual([1, 2, 3]);
    });
});
```

### Mockå‡½æ•°
```javascript
import {vi} from 'vitest';

describe('Mock functions', () => {
    it('should track calls', () => {
        const mockFn = vi.fn();
        mockFn('hello');
        mockFn('world');
        
        expect(mockFn).toHaveBeenCalledTimes(2);
        expect(mockFn).toHaveBeenCalledWith('hello');
        expect(mockFn).toHaveBeenLastCalledWith('world');
    });
    
    it('should return values', () => {
        const mockFn = vi.fn()
            .mockReturnValueOnce('first')
            .mockReturnValueOnce('second')
            .mockReturnValue('default');
        
        expect(mockFn()).toBe('first');
        expect(mockFn()).toBe('second');
        expect(mockFn()).toBe('default');
    });
    
    it('should mock implementation', () => {
        const mockFn = vi.fn((a, b) => a + b);
        expect(mockFn(1, 2)).toBe(3);
    });
});
```

### å¼‚æ­¥æµ‹è¯•
```javascript
describe('Async tests', () => {
    it('should handle promises', async () => {
        const data = await fetchData();
        expect(data).toEqual({id: 1});
    });
    
    it('should handle async/await', async () => {
        const result = await asyncFunction();
        expect(result).toBe('success');
    });
    
    it('should handle errors', async () => {
        await expect(failingAsync()).rejects.toThrow('Error');
    });
    
    it('should timeout', async () => {
        await new Promise(resolve => setTimeout(resolve, 100));
    }, {timeout: 1000});
});
```

## âš›ï¸ Reactç»„ä»¶æµ‹è¯•

### React Testing Library
```bash
# å®‰è£…
pnpm add -D @testing-library/react @testing-library/jest-dom
```

### åŸºæœ¬æµ‹è¯•
```jsx
import {render, screen, fireEvent} from '@testing-library/react';
import {describe, it, expect} from 'vitest';
import Counter from './Counter';

describe('Counter', () => {
    it('should render initial count', () => {
        render(<Counter />);
        expect(screen.getByText('Count: 0')).toBeInTheDocument();
    });
    
    it('should increment count', () => {
        render(<Counter />);
        const button = screen.getByRole('button', {name: /increment/i});
        fireEvent.click(button);
        expect(screen.getByText('Count: 1')).toBeInTheDocument();
    });
    
    it('should decrement count', async () => {
        render(<Counter />);
        const button = screen.getByRole('button', {name: /decrement/i});
        await userEvent.click(button);
        expect(screen.getByText('Count: -1')).toBeInTheDocument();
    });
});
```

### æµ‹è¯•Hooks
```javascript
import {renderHook, act} from '@testing-library/react';
import {useCounter} from './useCounter';

describe('useCounter', () => {
    it('should initialize with 0', () => {
        const {result} = renderHook(() => useCounter());
        expect(result.current.count).toBe(0);
    });
    
    it('should increment', () => {
        const {result} = renderHook(() => useCounter());
        act(() => {
            result.current.increment();
        });
        expect(result.current.count).toBe(1);
    });
});
```

### æµ‹è¯•å¼‚æ­¥ç»„ä»¶
```jsx
import {render, screen, waitFor} from '@testing-library/react';

describe('UserList', () => {
    it('should load and display users', async () => {
        render(<UserList />);
        
        // ç­‰å¾…åŠ è½½å®Œæˆ
        await waitFor(() => {
            expect(screen.getByText('John')).toBeInTheDocument();
        });
    });
    
    it('should handle errors', async () => {
        // Mock APIé”™è¯¯
        vi.spyOn(global, 'fetch').mockRejectedValueOnce(new Error('API Error'));
        
        render(<UserList />);
        
        await waitFor(() => {
            expect(screen.getByText(/error/i)).toBeInTheDocument();
        });
    });
});
```

## ğŸ’š Vueç»„ä»¶æµ‹è¯•

### Vue Test Utils
```bash
# å®‰è£…
pnpm add -D @vue/test-utils
```

### åŸºæœ¬æµ‹è¯•
```javascript
import {mount} from '@vue/test-utils';
import {describe, it, expect} from 'vitest';
import Counter from './Counter.vue';

describe('Counter.vue', () => {
    it('should render count', () => {
        const wrapper = mount(Counter);
        expect(wrapper.text()).toContain('Count: 0');
    });
    
    it('should increment', async () => {
        const wrapper = mount(Counter);
        await wrapper.find('button').trigger('click');
        expect(wrapper.text()).toContain('Count: 1');
    });
    
    it('should accept props', () => {
        const wrapper = mount(Counter, {
            props: {
                initialCount: 10
            }
        });
        expect(wrapper.text()).toContain('Count: 10');
    });
});
```

### æµ‹è¯•ç»„åˆå¼å‡½æ•°
```javascript
import {useCounter} from './useCounter';

describe('useCounter', () => {
    it('should increment', () => {
        const {count, increment} = useCounter();
        expect(count.value).toBe(0);
        increment();
        expect(count.value).toBe(1);
    });
});
```

## ğŸŒ E2Eæµ‹è¯•

### Playwrightï¼ˆæ¨èï¼‰
```bash
# å®‰è£…
pnpm create playwright

# è¿è¡Œæµ‹è¯•
pnpm playwright test
pnpm playwright test --ui
pnpm playwright show-report
```

### åŸºæœ¬E2Eæµ‹è¯•
```javascript
import {test, expect} from '@playwright/test';

test.describe('Login flow', () => {
    test('should login successfully', async ({page}) => {
        // è®¿é—®é¡µé¢
        await page.goto('http://localhost:3000/login');
        
        // å¡«å†™è¡¨å•
        await page.fill('input[name="email"]', 'user@example.com');
        await page.fill('input[name="password"]', 'password123');
        
        // ç‚¹å‡»æŒ‰é’®
        await page.click('button[type="submit"]');
        
        // éªŒè¯è·³è½¬
        await expect(page).toHaveURL('http://localhost:3000/dashboard');
        
        // éªŒè¯å…ƒç´ 
        await expect(page.locator('h1')).toContainText('Dashboard');
    });
    
    test('should show error for invalid credentials', async ({page}) => {
        await page.goto('http://localhost:3000/login');
        
        await page.fill('input[name="email"]', 'wrong@example.com');
        await page.fill('input[name="password"]', 'wrong');
        await page.click('button[type="submit"]');
        
        await expect(page.locator('.error')).toBeVisible();
    });
});
```

### é«˜çº§E2Eæµ‹è¯•
```javascript
test.describe('Shopping cart', () => {
    test.beforeEach(async ({page}) => {
        // ç™»å½•
        await page.goto('/login');
        await page.fill('[name="email"]', 'user@example.com');
        await page.fill('[name="password"]', 'password');
        await page.click('button[type="submit"]');
        await page.waitForURL('/dashboard');
    });
    
    test('should add item to cart', async ({page}) => {
        await page.goto('/products');
        
        // ç‚¹å‡»ç¬¬ä¸€ä¸ªäº§å“
        await page.click('.product-card:first-child button');
        
        // éªŒè¯è´­ç‰©è½¦æ•°é‡
        const badge = page.locator('.cart-badge');
        await expect(badge).toHaveText('1');
        
        // æˆªå›¾
        await page.screenshot({path: 'cart.png'});
    });
});
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### é…ç½®è¦†ç›–ç‡
```javascript
// vitest.config.ts
export default defineConfig({
    test: {
        coverage: {
            provider: 'v8',
            reporter: ['text', 'json', 'html', 'lcov'],
            exclude: [
                'node_modules/',
                'tests/',
                '**/*.test.{js,ts,jsx,tsx}',
                '**/*.config.{js,ts}',
                '**/types.ts'
            ],
            thresholds: {
                lines: 80,
                functions: 80,
                branches: 80,
                statements: 80
            }
        }
    }
});
```

### æŸ¥çœ‹è¦†ç›–ç‡
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage

# æ‰“å¼€HTMLæŠ¥å‘Š
open coverage/index.html
```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. AAAæ¨¡å¼
```javascript
test('should add item to list', () => {
    // Arrangeï¼ˆå‡†å¤‡ï¼‰
    const list = new List();
    const item = {id: 1, name: 'Item'};
    
    // Actï¼ˆæ‰§è¡Œï¼‰
    list.add(item);
    
    // Assertï¼ˆæ–­è¨€ï¼‰
    expect(list.items).toHaveLength(1);
    expect(list.items[0]).toEqual(item);
});
```

### 2. æµ‹è¯•éš”ç¦»
```javascript
describe('User service', () => {
    let userService;
    
    beforeEach(() => {
        // æ¯ä¸ªæµ‹è¯•å‰é‡ç½®
        userService = new UserService();
    });
    
    afterEach(() => {
        // æ¸…ç†
        userService.clear();
    });
    
    it('should create user', () => {
        const user = userService.create('John');
        expect(user.name).toBe('John');
    });
});
```

### 3. Mockå¤–éƒ¨ä¾èµ–
```javascript
import {vi} from 'vitest';
import {fetchUser} from './api';

vi.mock('./api', () => ({
    fetchUser: vi.fn()
}));

test('should fetch user', async () => {
    fetchUser.mockResolvedValue({id: 1, name: 'John'});
    
    const user = await getUser(1);
    
    expect(fetchUser).toHaveBeenCalledWith(1);
    expect(user.name).toBe('John');
});
```

### 4. å¿«ç…§æµ‹è¯•
```javascript
import {render} from '@testing-library/react';

test('should match snapshot', () => {
    const {container} = render(<Button>Click me</Button>);
    expect(container).toMatchSnapshot();
});
```

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actions
```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
    test:
        runs-on: ubuntu-latest
        
        steps:
            - uses: actions/checkout@v3
            
            - name: Setup Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: '20'
            
            - name: Install dependencies
              run: pnpm install
            
            - name: Run tests
              run: pnpm test:coverage
            
            - name: Upload coverage
              uses: codecov/codecov-action@v3
```

## ğŸ“š æµ‹è¯•å·¥å…·æ¨è

### å•å…ƒæµ‹è¯•
- Vitest
- Jest
- Mocha + Chai

### ç»„ä»¶æµ‹è¯•
- React Testing Library
- Vue Test Utils
- Enzymeï¼ˆReactæ—§é¡¹ç›®ï¼‰

### E2Eæµ‹è¯•
- Playwright
- Cypress
- Puppeteer

### å…¶ä»–å·¥å…·
- MSWï¼šAPI Mock
- Faker.jsï¼šæµ‹è¯•æ•°æ®ç”Ÿæˆ
- Testing Playgroundï¼šé€‰æ‹©å™¨è¾…åŠ©

## ğŸ“š å‚è€ƒèµ„æ–™
- [Vitestæ–‡æ¡£](https://vitest.dev/)
- [React Testing Library](https://testing-library.com/react)
- [Vue Test Utils](https://test-utils.vuejs.org/)
- [Playwrightæ–‡æ¡£](https://playwright.dev/)

